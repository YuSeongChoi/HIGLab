<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ“¶ Core Bluetooth â€” HIG Lab</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
<style>
:root{--bg:#fafafa;--text:#1d1d1f;--text-2:#6e6e73;--accent:#0071e3;--code-bg:#1e1e2e;--border:#d2d2d7}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.8}
.top-bar{position:sticky;top:0;z-index:100;background:rgba(250,250,250,0.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border)}
.top-bar-inner{max-width:800px;margin:0 auto;padding:12px 24px;display:flex;justify-content:space-between}
.top-logo{font-size:16px;font-weight:700;text-decoration:none;color:var(--text)}.top-logo span{color:var(--accent)}
article{max-width:800px;margin:0 auto;padding:48px 24px 120px}
h1{font-size:clamp(28px,5vw,40px);font-weight:900;margin-bottom:16px;letter-spacing:-1px}
h2{font-size:24px;font-weight:800;margin:48px 0 16px}p{margin-bottom:16px}
.subtitle{font-size:18px;color:var(--text-2);margin-bottom:32px}
.code-block{background:var(--code-bg);border-radius:12px;margin:20px 0;overflow:hidden}
.code-header{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.1);font-size:12px;color:#6e6e73;font-weight:600}
pre.code-body{margin:0;padding:16px;font-family:'JetBrains Mono',monospace;font-size:13px;color:#cdd6f4;white-space:pre;overflow-x:auto}
.kw{color:#cba6f7}.type{color:#89b4fa}.str{color:#a6e3a1}.comment{color:#6c7086}
.badge{display:inline-block;padding:4px 12px;border-radius:16px;font-size:13px;font-weight:600;margin:0 4px 8px 0}
.badge.ios{background:#0071e3;color:#fff}.badge.new{background:#34c759;color:#fff}
ul{margin:16px 0 16px 24px}li{margin:8px 0}
.info-box{background:#f5f5f7;border-left:4px solid var(--accent);padding:16px;margin:24px 0;border-radius:8px}
</style></head>
<body>
<div class="top-bar"><div class="top-bar-inner"><a href="../index.html" class="top-logo">HIG <span>Lab</span></a><a href="01-ble-device-scanner.html" class="lang-toggle" style="font-size:12px;font-weight:600;color:#0071e3;text-decoration:none;padding:4px 10px;border:1.5px solid #0071e3;border-radius:12px;">ğŸŒ KO</a></div></div>
<article>
<h1>ğŸ“¶ Core Bluetooth</h1>
<!-- higlab-metadata -->
<div style="display:flex;gap:16px;align-items:center;margin:12px 0 24px;padding:12px 16px;background:var(--tag-bg,#f5f5f7);border-radius:10px;font-size:13px;color:var(--text-2,#6e6e73);flex-wrap:wrap;">
  <span>â­ Difficulty: â­â­â­â­</span>
  <span>â±ï¸ Est. Time: 3-4h</span>
  <span>ğŸ“‚ System & Network</span>
</div>
<p class="subtitle">BLE device scanning, connection, and data communication</p>

<div><span class="badge ios">iOS 5+</span><span class="badge new">BLE 5.0</span></div>

<h2>âœ¨ Core Bluetooth?</h2>
<p>Core Bluetooth is a framework that uses the Bluetooth Low Energy (BLE) protocol to scan, connect, and exchange data with nearby devices. You can communicate with smartwatches, fitness trackers, sensors, and IoT devices, reading and writing data through GATT services and characteristics. It operates on the Central-Peripheral architecture.</p>

<div class="info-box">
<strong>ğŸ’¡ Key Features:</strong> BLE Device Scanning Â· Peripheral Connection Â· GATT Service Discovery Â· Characteristic Read/Write Â· Notification Subscription Â· Battery-Efficient Communication Â· Background Operation
</div>

<h2>ğŸ”Œ 1. CBCentralManager Initialization</h2>
<p>Create a manager that scans and connects BLE devices as a Central role.</p>

<div class="code-block">
<div class="code-header">BluetoothManager.swift â€” Central Manager Initialization</div>
<pre class="code-body"><span class="kw">import</span> <span class="type">CoreBluetooth</span>
<span class="kw">import</span> <span class="type">SwiftUI</span>

<span class="kw">@Observable</span>
<span class="kw">class</span> <span class="type">BluetoothManager</span>: <span class="type">NSObject</span> {
    <span class="kw">private</span> <span class="kw">var</span> centralManager: <span class="type">CBCentralManager</span>!
    <span class="kw">var</span> discoveredPeripherals: [<span class="type">CBPeripheral</span>] = []
    <span class="kw">var</span> connectedPeripheral: <span class="type">CBPeripheral</span>?
    <span class="kw">var</span> isBluetoothOn = <span class="kw">false</span>
    <span class="kw">var</span> isScanning = <span class="kw">false</span>

    <span class="kw">override</span> <span class="kw">init</span>() {
        <span class="kw">super</span>.<span class="kw">init</span>()
        <span class="comment">// Central Manager ìƒì„±</span>
        centralManager = <span class="type">CBCentralManager</span>(delegate: <span class="kw">self</span>, queue: <span class="kw">nil</span>)
    }

    <span class="comment">// Start scanning</span>
    <span class="kw">func</span> startScanning() {
        <span class="kw">guard</span> isBluetoothOn <span class="kw">else</span> {
            print(<span class="str">"âš ï¸ Bluetoothê°€ êº¼ì ¸ ìˆìŠµë‹ˆë‹¤"</span>)
            <span class="kw">return</span>
        }

        discoveredPeripherals.removeAll()
        isScanning = <span class="kw">true</span>

        <span class="comment">// all BLE ê¸°ê¸° ìŠ¤ìº” (ì„œë¹„ìŠ¤ í•„í„° ì—†ìŒ)</span>
        centralManager.scanForPeripherals(
            withServices: <span class="kw">nil</span>,
            options: [<span class="type">CBCentralManagerScanOptionAllowDuplicatesKey</span>: <span class="kw">false</span>]
        )

        print(<span class="str">"ğŸ” BLE ê¸°ê¸° Start scanning"</span>)
    }

    <span class="comment">// íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ìŠ¤ìº”</span>
    <span class="kw">func</span> scanForDevices(withServices serviceUUIDs: [<span class="type">CBUUID</span>]) {
        <span class="kw">guard</span> isBluetoothOn <span class="kw">else</span> { <span class="kw">return</span> }

        discoveredPeripherals.removeAll()
        isScanning = <span class="kw">true</span>

        centralManager.scanForPeripherals(withServices: serviceUUIDs, options: <span class="kw">nil</span>)
        print(<span class="str">"ğŸ” íŠ¹ì • ì„œë¹„ìŠ¤ ìŠ¤ìº”: \(serviceUUIDs)"</span>)
    }

    <span class="comment">// Stop scanning</span>
    <span class="kw">func</span> stopScanning() {
        centralManager.stopScan()
        isScanning = <span class="kw">false</span>
        print(<span class="str">"â¹ï¸ Stop scanning"</span>)
    }

    <span class="comment">// Peripheral ì—°ê²°</span>
    <span class="kw">func</span> connect(peripheral: <span class="type">CBPeripheral</span>) {
        stopScanning()
        centralManager.connect(peripheral, options: <span class="kw">nil</span>)
        print(<span class="str">"ğŸ”— ì—°ê²° ì‹œë„: \(peripheral.name ?? "Unknown")"</span>)
    }

    <span class="comment">// Connect í•´ì œ</span>
    <span class="kw">func</span> disconnect() {
        <span class="kw">guard</span> <span class="kw">let</span> peripheral = connectedPeripheral <span class="kw">else</span> { <span class="kw">return</span> }
        centralManager.cancelPeripheralConnection(peripheral)
        print(<span class="str">"âŒ ì—°ê²° í•´ì œ"</span>)
    }
}</pre>
</div>

<h2>ğŸ“¡ 2. Central Manager Delegate</h2>
<p>Handle Bluetooth state changes and device discovery.</p>

<div class="code-block">
<div class="code-header">BluetoothManager+Delegate.swift â€” Central Delegate</div>
<pre class="code-body"><span class="kw">import</span> <span class="type">CoreBluetooth</span>

<span class="kw">extension</span> <span class="type">BluetoothManager</span>: <span class="type">CBCentralManagerDelegate</span> {
    <span class="comment">// Bluetooth state change</span>
    <span class="kw">func</span> centralManagerDidUpdateState(<span class="kw">_</span> central: <span class="type">CBCentralManager</span>) {
        <span class="kw">switch</span> central.state {
        <span class="kw">case</span> .poweredOn:
            print(<span class="str">"âœ… Bluetooth ì¼œì§"</span>)
            isBluetoothOn = <span class="kw">true</span>
        <span class="kw">case</span> .poweredOff:
            print(<span class="str">"âŒ Bluetooth êº¼ì§"</span>)
            isBluetoothOn = <span class="kw">false</span>
        <span class="kw">case</span> .unauthorized:
            print(<span class="str">"âš ï¸ Bluetooth ê¶Œí•œ ì—†ìŒ"</span>)
            isBluetoothOn = <span class="kw">false</span>
        <span class="kw">case</span> .unsupported:
            print(<span class="str">"âŒ Bluetooth Not supported"</span>)
            isBluetoothOn = <span class="kw">false</span>
        <span class="kw">case</span> .resetting:
            print(<span class="str">"ğŸ”„ Bluetooth ì¬ì„¤ì • ì¤‘"</span>)
        <span class="kw">case</span> .unknown:
            print(<span class="str">"â“ Bluetooth ìƒíƒœ ë¶ˆëª…"</span>)
        <span class="kw">@unknown</span> <span class="kw">default</span>:
            <span class="kw">break</span>
        }
    }

    <span class="comment">// Peripheral ë°œê²¬</span>
    <span class="kw">func</span> centralManager(
        <span class="kw">_</span> central: <span class="type">CBCentralManager</span>,
        didDiscover peripheral: <span class="type">CBPeripheral</span>,
        advertisementData: [<span class="type">String</span>: <span class="type">Any</span>],
        rssi <span class="type">RSSI</span>: <span class="type">NSNumber</span>
    ) {
        <span class="comment">// ì´ë¯¸ ë°œê²¬ëœ ê¸°ê¸°ëŠ” ì¶”ê°€í•˜ì§€ ì•ŠìŒ</span>
        <span class="kw">guard</span> !discoveredPeripherals.contains(where: { $0.identifier == peripheral.identifier }) <span class="kw">else</span> {
            <span class="kw">return</span>
        }

        discoveredPeripherals.append(peripheral)

        <span class="kw">let</span> deviceName = peripheral.name ?? <span class="str">"Unknown Device"</span>
        <span class="kw">let</span> signalStrength = <span class="type">RSSI</span>.intValue
        print(<span class="str">"ğŸ“¶ ë°œê²¬: \(deviceName) (RSSI: \(signalStrength)dBm)"</span>)

        <span class="comment">// Advertisement Data ì¶œë ¥</span>
        <span class="kw">if</span> <span class="kw">let</span> localName = advertisementData[<span class="type">CBAdvertisementDataLocalNameKey</span>] <span class="kw">as</span>? <span class="type">String</span> {
            print(<span class="str">"  Local Name: \(localName)"</span>)
        }
        <span class="kw">if</span> <span class="kw">let</span> serviceUUIDs = advertisementData[<span class="type">CBAdvertisementDataServiceUUIDsKey</span>] <span class="kw">as</span>? [<span class="type">CBUUID</span>] {
            print(<span class="str">"  Services: \(serviceUUIDs)"</span>)
        }
    }

    <span class="comment">// Connection successful</span>
    <span class="kw">func</span> centralManager(<span class="kw">_</span> central: <span class="type">CBCentralManager</span>, didConnect peripheral: <span class="type">CBPeripheral</span>) {
        print(<span class="str">"âœ… Connection successful: \(peripheral.name ?? "Unknown")"</span>)
        connectedPeripheral = peripheral
        peripheral.delegate = <span class="kw">self</span>

        <span class="comment">// ì„œë¹„ìŠ¤ íƒìƒ‰</span>
        peripheral.discoverServices(<span class="kw">nil</span>)
    }

    <span class="comment">// Connection failed</span>
    <span class="kw">func</span> centralManager(<span class="kw">_</span> central: <span class="type">CBCentralManager</span>, didFailToConnect peripheral: <span class="type">CBPeripheral</span>, error: <span class="type">Error</span>?) {
        print(<span class="str">"âŒ Connection failed: \(error?.localizedDescription ?? "Unknown error")"</span>)
        connectedPeripheral = <span class="kw">nil</span>
    }

    <span class="comment">// Connect í•´ì œ</span>
    <span class="kw">func</span> centralManager(<span class="kw">_</span> central: <span class="type">CBCentralManager</span>, didDisconnectPeripheral peripheral: <span class="type">CBPeripheral</span>, error: <span class="type">Error</span>?) {
        print(<span class="str">"âŒ ì—°ê²° í•´ì œ: \(peripheral.name ?? "Unknown")"</span>)
        connectedPeripheral = <span class="kw">nil</span>

        <span class="kw">if</span> <span class="kw">let</span> error = error {
            print(<span class="str">"  Error: \(error.localizedDescription)"</span>)
        }
    }
}</pre>
</div>

<h2>ğŸ› ï¸ 3. Peripheral Delegate</h2>
<p>Discover services and characteristics, and read data.</p>

<div class="code-block">
<div class="code-header">BluetoothManager+Peripheral.swift â€” Peripheral Delegate</div>
<pre class="code-body"><span class="kw">import</span> <span class="type">CoreBluetooth</span>

<span class="kw">extension</span> <span class="type">BluetoothManager</span>: <span class="type">CBPeripheralDelegate</span> {
    <span class="comment">// ì„œë¹„ìŠ¤ ë°œê²¬</span>
    <span class="kw">func</span> peripheral(<span class="kw">_</span> peripheral: <span class="type">CBPeripheral</span>, didDiscoverServices error: <span class="type">Error</span>?) {
        <span class="kw">if</span> <span class="kw">let</span> error = error {
            print(<span class="str">"âŒ ì„œë¹„ìŠ¤ ë°œê²¬ ì‹¤íŒ¨: \(error.localizedDescription)"</span>)
            <span class="kw">return</span>
        }

        <span class="kw">guard</span> <span class="kw">let</span> services = peripheral.services <span class="kw">else</span> { <span class="kw">return</span> }

        print(<span class="str">"ğŸ” ë°œê²¬ëœ ì„œë¹„ìŠ¤: \(services.count)ê°œ"</span>)

        <span class="kw">for</span> service <span class="kw">in</span> services {
            print(<span class="str">"  Service UUID: \(service.uuid)"</span>)
            <span class="comment">// each ì„œë¹„ìŠ¤ì˜ íŠ¹ì„± íƒìƒ‰</span>
            peripheral.discoverCharacteristics(<span class="kw">nil</span>, for: service)
        }
    }

    <span class="comment">// íŠ¹ì„± ë°œê²¬</span>
    <span class="kw">func</span> peripheral(<span class="kw">_</span> peripheral: <span class="type">CBPeripheral</span>, didDiscoverCharacteristicsFor service: <span class="type">CBService</span>, error: <span class="type">Error</span>?) {
        <span class="kw">if</span> <span class="kw">let</span> error = error {
            print(<span class="str">"âŒ íŠ¹ì„± ë°œê²¬ ì‹¤íŒ¨: \(error.localizedDescription)"</span>)
            <span class="kw">return</span>
        }

        <span class="kw">guard</span> <span class="kw">let</span> characteristics = service.characteristics <span class="kw">else</span> { <span class="kw">return</span> }

        print(<span class="str">"ğŸ” ì„œë¹„ìŠ¤ \(service.uuid)ì˜ íŠ¹ì„±: \(characteristics.count)ê°œ"</span>)

        <span class="kw">for</span> characteristic <span class="kw">in</span> characteristics {
            print(<span class="str">"  Characteristic UUID: \(characteristic.uuid)"</span>)
            print(<span class="str">"  Properties: \(characteristic.properties)"</span>)

            <span class="comment">// ì½ê¸° ê°€ëŠ¥í•˜ë©´ ì½ê¸°</span>
            <span class="kw">if</span> characteristic.properties.contains(.read) {
                peripheral.readValue(for: characteristic)
            }

            <span class="comment">// Notify ê°€ëŠ¥í•˜ë©´ êµ¬ë…</span>
            <span class="kw">if</span> characteristic.properties.contains(.notify) {
                peripheral.setNotifyValue(<span class="kw">true</span>, for: characteristic)
                print(<span class="str">"  ğŸ“¬ Notification êµ¬ë…"</span>)
            }
        }
    }

    <span class="comment">// íŠ¹ì„± ê°’ ì½ê¸° ì™„ë£Œ</span>
    <span class="kw">func</span> peripheral(<span class="kw">_</span> peripheral: <span class="type">CBPeripheral</span>, didUpdateValueFor characteristic: <span class="type">CBCharacteristic</span>, error: <span class="type">Error</span>?) {
        <span class="kw">if</span> <span class="kw">let</span> error = error {
            print(<span class="str">"âŒ ê°’ ì½ê¸° ì‹¤íŒ¨: \(error.localizedDescription)"</span>)
            <span class="kw">return</span>
        }

        <span class="kw">guard</span> <span class="kw">let</span> data = characteristic.value <span class="kw">else</span> {
            print(<span class="str">"âš ï¸ ë°ì´í„° ì—†ìŒ"</span>)
            <span class="kw">return</span>
        }

        print(<span class="str">"ğŸ“¥ Receive data (\(characteristic.uuid)): \(data.hexString)"</span>)

        <span class="comment">// Stringìœ¼ë¡œ ë³€í™˜ ì‹œë„</span>
        <span class="kw">if</span> <span class="kw">let</span> stringValue = <span class="type">String</span>(data: data, encoding: .utf8) {
            print(<span class="str">"  String: \(stringValue)"</span>)
        }

        <span class="comment">// íŠ¹ì • ì„œë¹„ìŠ¤ë³„ íŒŒì‹±</span>
        parseCharacteristicValue(characteristic, data: data)
    }

    <span class="comment">// íŠ¹ì„± ê°’ ì“°ê¸° ì™„ë£Œ</span>
    <span class="kw">func</span> peripheral(<span class="kw">_</span> peripheral: <span class="type">CBPeripheral</span>, didWriteValueFor characteristic: <span class="type">CBCharacteristic</span>, error: <span class="type">Error</span>?) {
        <span class="kw">if</span> <span class="kw">let</span> error = error {
            print(<span class="str">"âŒ ì“°ê¸° ì‹¤íŒ¨: \(error.localizedDescription)"</span>)
            <span class="kw">return</span>
        }

        print(<span class="str">"âœ… ì“°ê¸° ì„±ê³µ (\(characteristic.uuid))"</span>)
    }

    <span class="comment">// Notification change state</span>
    <span class="kw">func</span> peripheral(<span class="kw">_</span> peripheral: <span class="type">CBPeripheral</span>, didUpdateNotificationStateFor characteristic: <span class="type">CBCharacteristic</span>, error: <span class="type">Error</span>?) {
        <span class="kw">if</span> <span class="kw">let</span> error = error {
            print(<span class="str">"âŒ Notification ì„¤ì • ì‹¤íŒ¨: \(error.localizedDescription)"</span>)
            <span class="kw">return</span>
        }

        <span class="kw">if</span> characteristic.isNotifying {
            print(<span class="str">"âœ… Notification í™œì„±í™” (\(characteristic.uuid))"</span>)
        } <span class="kw">else</span> {
            print(<span class="str">"âŒ Notification ë¹„í™œì„±í™” (\(characteristic.uuid))"</span>)
        }
    }

    <span class="comment">// íŠ¹ì„± ê°’ íŒŒì‹± (ì„œë¹„ìŠ¤ë³„ ì²˜ë¦¬)</span>
    <span class="kw">private</span> <span class="kw">func</span> parseCharacteristicValue(<span class="kw">_</span> characteristic: <span class="type">CBCharacteristic</span>, data: <span class="type">Data</span>) {
        <span class="comment">// Heart Rate Service (0x180D)</span>
        <span class="kw">if</span> characteristic.uuid == <span class="type">CBUUID</span>(string: <span class="str">"2A37"</span>) {
            <span class="kw">let</span> heartRate = parseHeartRate(data)
            print(<span class="str">"  â¤ï¸ Heart Rate: \(heartRate) bpm"</span>)
        }
        <span class="comment">// Battery Level (0x2A19)</span>
        <span class="kw">else</span> <span class="kw">if</span> characteristic.uuid == <span class="type">CBUUID</span>(string: <span class="str">"2A19"</span>) {
            <span class="kw">if</span> <span class="kw">let</span> batteryLevel = data.first {
                print(<span class="str">"  ğŸ”‹ Battery: \(batteryLevel)%"</span>)
            }
        }
    }

    <span class="comment">// Heart Rate ë°ì´í„° íŒŒì‹±</span>
    <span class="kw">private</span> <span class="kw">func</span> parseHeartRate(<span class="kw">_</span> data: <span class="type">Data</span>) -> <span class="type">Int</span> {
        <span class="kw">guard</span> data.count > <span class="str">1</span> <span class="kw">else</span> { <span class="kw">return</span> <span class="str">0</span> }
        <span class="kw">let</span> flags = data[<span class="str">0</span>]
        <span class="kw">let</span> is16Bit = (flags & <span class="str">0x01</span>) == <span class="str">0x01</span>

        <span class="kw">if</span> is16Bit {
            <span class="kw">return</span> <span class="type">Int</span>(data[<span class="str">1</span>]) | (<span class="type">Int</span>(data[<span class="str">2</span>]) << <span class="str">8</span>)
        } <span class="kw">else</span> {
            <span class="kw">return</span> <span class="type">Int</span>(data[<span class="str">1</span>])
        }
    }
}

<span class="comment">// Data Extension</span>
<span class="kw">extension</span> <span class="type">Data</span> {
    <span class="kw">var</span> hexString: <span class="type">String</span> {
        map { <span class="type">String</span>(format: <span class="str">"%02X"</span>, $0) }.joined(separator: <span class="str">" "</span>)
    }
}</pre>
</div>

<h2>ğŸ“¤ 4. Writing Data</h2>
<p>Peripheralì— ë°ì´í„°ë¥¼ ì „ì†¡.</p>

<div class="code-block">
<div class="code-header">BluetoothManager+Write.swift â€” Data Writing</div>
<pre class="code-body"><span class="kw">import</span> <span class="type">CoreBluetooth</span>

<span class="kw">extension</span> <span class="type">BluetoothManager</span> {
    <span class="comment">// ë¬¸ìì—´ Send data</span>
    <span class="kw">func</span> writeString(<span class="kw">_</span> string: <span class="type">String</span>, to characteristic: <span class="type">CBCharacteristic</span>) {
        <span class="kw">guard</span> <span class="kw">let</span> data = string.data(using: .utf8) <span class="kw">else</span> {
            print(<span class="str">"âŒ ë¬¸ìì—´ Conversion failed"</span>)
            <span class="kw">return</span>
        }

        writeData(data, to: characteristic)
    }

    <span class="comment">// bytes Send data</span>
    <span class="kw">func</span> writeData(<span class="kw">_</span> data: <span class="type">Data</span>, to characteristic: <span class="type">CBCharacteristic</span>) {
        <span class="kw">guard</span> <span class="kw">let</span> peripheral = connectedPeripheral <span class="kw">else</span> {
            print(<span class="str">"âŒ ì—°ê²°ëœ ê¸°ê¸° ì—†ìŒ"</span>)
            <span class="kw">return</span>
        }

        <span class="comment">// ì“°ê¸° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸</span>
        <span class="kw">guard</span> characteristic.properties.contains(.write) || characteristic.properties.contains(.writeWithoutResponse) <span class="kw">else</span> {
            print(<span class="str">"âŒ ì“°ê¸° ë¶ˆê°€ëŠ¥í•œ íŠ¹ì„±"</span>)
            <span class="kw">return</span>
        }

        <span class="comment">// ì“°ê¸° íƒ€ì… ê²°ì •</span>
        <span class="kw">let</span> writeType: <span class="type">CBCharacteristicWriteType</span> = characteristic.properties.contains(.write) ? .withResponse : .withoutResponse

        peripheral.writeValue(data, for: characteristic, type: writeType)
        print(<span class="str">"ğŸ“¤ Send data: \(data.hexString)"</span>)
    }

    <span class="comment">// LED ì œì–´ ì˜ˆì œ</span>
    <span class="kw">func</span> toggleLED(characteristic: <span class="type">CBCharacteristic</span>, isOn: <span class="type">Bool</span>) {
        <span class="kw">let</span> command: <span class="type">UInt8</span> = isOn ? <span class="str">0x01</span> : <span class="str">0x00</span>
        <span class="kw">let</span> data = <span class="type">Data</span>([command])
        writeData(data, to: characteristic)
    }
}</pre>
</div>

<h2>ğŸ“± 5. SwiftUI Integration</h2>
<p>BLE ìŠ¤ìºë„ˆ UI implementation.</p>

<div class="code-block">
<div class="code-header">BLEScannerView.swift â€” BLE Scanner UI</div>
<pre class="code-body"><span class="kw">import</span> <span class="type">SwiftUI</span>
<span class="kw">import</span> <span class="type">CoreBluetooth</span>

<span class="kw">struct</span> <span class="type">BLEScannerView</span>: <span class="type">View</span> {
    <span class="kw">@State</span> <span class="kw">private</span> <span class="kw">var</span> bluetoothManager = <span class="type">BluetoothManager</span>()

    <span class="kw">var</span> body: <span class="kw">some</span> <span class="type">View</span> {
        <span class="type">NavigationStack</span> {
            <span class="type">VStack</span>(spacing: <span class="str">0</span>) {
                <span class="comment">// Status í‘œì‹œ</span>
                statusHeader

                <span class="comment">// ê¸°ê¸° ëª©ë¡</span>
                <span class="kw">if</span> bluetoothManager.discoveredPeripherals.isEmpty {
                    emptyState
                } <span class="kw">else</span> {
                    deviceList
                }
            }
            .navigationTitle(<span class="str">"BLE ìŠ¤ìºë„ˆ"</span>)
            .toolbar {
                <span class="type">ToolbarItem</span>(placement: .topBarTrailing) {
                    scanButton
                }
            }
        }
    }

    <span class="comment">// Status í—¤ë”</span>
    <span class="kw">private</span> <span class="kw">var</span> statusHeader: <span class="kw">some</span> <span class="type">View</span> {
        <span class="type">VStack</span>(spacing: <span class="str">8</span>) {
            <span class="type">HStack</span> {
                <span class="type">Circle</span>()
                    .fill(bluetoothManager.isBluetoothOn ? <span class="type">Color</span>.green : <span class="type">Color</span>.red)
                    .frame(width: <span class="str">12</span>, height: <span class="str">12</span>)

                <span class="type">Text</span>(bluetoothManager.isBluetoothOn ? <span class="str">"Bluetooth í™œì„±"</span> : <span class="str">"Bluetooth ë¹„í™œì„±"</span>)
                    .font(.subheadline)
                    .foregroundStyle(.secondary)

                <span class="type">Spacer</span>()

                <span class="kw">if</span> bluetoothManager.isScanning {
                    <span class="type">ProgressView</span>()
                        .controlSize(.small)
                    <span class="type">Text</span>(<span class="str">"ìŠ¤ìº” ì¤‘..."</span>)
                        .font(.caption)
                        .foregroundStyle(.secondary)
                }
            }
            .padding()

            <span class="kw">if</span> <span class="kw">let</span> connected = bluetoothManager.connectedPeripheral {
                <span class="type">HStack</span> {
                    <span class="type">Image</span>(systemName: <span class="str">"checkmark.circle.fill"</span>)
                        .foregroundStyle(.green)
                    <span class="type">Text</span>(<span class="str">"Connected: \(connected.name ?? "Unknown")"</span>)
                        .font(.subheadline)
                    <span class="type">Spacer</span>()
                    <span class="type">Button</span>(<span class="str">"ì—°ê²° í•´ì œ"</span>) {
                        bluetoothManager.disconnect()
                    }
                    .font(.caption)
                    .buttonStyle(.bordered)
                }
                .padding(.horizontal)
                .padding(.bottom)
            }
        }
        .background(<span class="type">Color</span>(.systemGroupedBackground))
    }

    <span class="comment">// ìŠ¤ìº” ë²„íŠ¼</span>
    <span class="kw">private</span> <span class="kw">var</span> scanButton: <span class="kw">some</span> <span class="type">View</span> {
        <span class="type">Button</span> {
            <span class="kw">if</span> bluetoothManager.isScanning {
                bluetoothManager.stopScanning()
            } <span class="kw">else</span> {
                bluetoothManager.startScanning()
            }
        } label: {
            <span class="type">Image</span>(systemName: bluetoothManager.isScanning ? <span class="str">"stop.circle"</span> : <span class="str">"arrow.clockwise"</span>)
        }
        .disabled(!bluetoothManager.isBluetoothOn)
    }

    <span class="comment">// ë¹ˆ ìƒíƒœ</span>
    <span class="kw">private</span> <span class="kw">var</span> emptyState: <span class="kw">some</span> <span class="type">View</span> {
        <span class="type">ContentUnavailableView</span> {
            <span class="type">Label</span>(<span class="str">"BLE ê¸°ê¸°ë¥¼ Not found"</span>, systemImage: <span class="str">"antenna.radiowaves.left.and.right.slash"</span>)
        } description: {
            <span class="type">Text</span>(<span class="str">"ìŠ¤ìº” ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ë³€ BLE ê¸°ê¸°ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”"</span>)
        }
    }

    <span class="comment">// ê¸°ê¸° ëª©ë¡</span>
    <span class="kw">private</span> <span class="kw">var</span> deviceList: <span class="kw">some</span> <span class="type">View</span> {
        <span class="type">List</span>(bluetoothManager.discoveredPeripherals, id: \.identifier) { peripheral <span class="kw">in</span>
            <span class="type">Button</span> {
                bluetoothManager.connect(peripheral: peripheral)
            } label: {
                <span class="type">HStack</span> {
                    <span class="type">VStack</span>(alignment: .leading, spacing: <span class="str">4</span>) {
                        <span class="type">Text</span>(peripheral.name ?? <span class="str">"Unknown Device"</span>)
                            .font(.headline)

                        <span class="type">Text</span>(peripheral.identifier.uuidString)
                            .font(.caption)
                            .foregroundStyle(.secondary)

                        <span class="kw">if</span> peripheral.state == .connected {
                            <span class="type">Text</span>(<span class="str">"Connected"</span>)
                                .font(.caption2)
                                .foregroundStyle(.green)
                        }
                    }

                    <span class="type">Spacer</span>()

                    <span class="type">Image</span>(systemName: <span class="str">"chevron.right"</span>)
                        .font(.caption)
                        .foregroundStyle(.secondary)
                }
            }
            .disabled(peripheral.state == .connected)
        }
    }
}</pre>
</div>

<h2>ğŸ’¡ HIG Guidelines</h2>

<ul>
<li><strong>Permission Request:</strong> Add NSBluetoothAlwaysUsageDescription to Info.plist</li>
<li><strong>Battery Efficiency:</strong> ë¶ˆí•„ìš”í•œ Stop scanning, ì—°ê²° í›„ ì¦‰ì‹œ ìŠ¤ìº” ì¤‘ë‹¨</li>
<li><strong>Background:</strong> Add bluetooth-central background mode to Info.plist</li>
<li><strong>ì‚¬ìš©ì í”¼ë“œë°±:</strong> ìŠ¤ìº” ìƒíƒœì™€ ì—°ê²° ìƒíƒœë¥¼ ëª…í™•íˆ í‘œì‹œ</li>
<li><strong>Error Handling:</strong> Provide appropriate guidance for connection failures, Bluetooth off, etc.</li>
</ul>

<h2>ğŸ¯ Practical Usage</h2>

<ul>
<li><strong>Fitness Apps:</strong> ì‹¬ë°•ìˆ˜ ì„¼ì„œ, ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ ì—°ë™</li>
<li><strong>IoT Control:</strong> Smart home device control</li>
<li><strong>ì˜ë£Œ ê¸°ê¸°:</strong> í˜ˆì••ê³„, í˜ˆë‹¹ê³„ ë°ì´í„° ìˆ˜ì§‘</li>
<li><strong>ìœ„ì¹˜ ë¹„ì½˜:</strong> iBeacon ê¸°ë°˜ ê·¼ì ‘ ë§ˆì¼€íŒ…</li>
<li><strong>ê²Œì„ ì»¨íŠ¸ë¡¤ëŸ¬:</strong> BLE ê²Œì„íŒ¨ë“œ ì—°ë™</li>
</ul>

<h2>ğŸ“š Learn More</h2>

<ul>
<li><a href="https://developer.apple.com/documentation/corebluetooth">Core Bluetooth Official Documentation</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/901/">WWDC: Core Bluetooth ì„¸ì…˜</a></li>
<li><a href="https://developer.apple.com/design/human-interface-guidelines/bluetooth">HIG: Bluetooth</a></li>
</ul>

<div class="info-box">
<strong>âš¡ï¸ Performance Tips:</strong> ìŠ¤ìº” ì‹œ <code>allowDuplicatesKey</code> to false to reduce battery consumption. Filter by specific service UUIDs to find target devices faster. Always stop scanning after connecting.
</div>

<div style="margin-top:48px;padding:24px;background:linear-gradient(135deg,#f5f5f7,#e8e8ed);border-radius:16px;">
  <h2 style="font-size:20px;margin-bottom:12px;">ğŸ“ Apple Official Resources</h2>
  <div style="display:flex;flex-wrap:wrap;gap:12px;">
    <a href="https://developer.apple.com/documentation/corebluetooth" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:10px 16px;background:white;border-radius:10px;text-decoration:none;color:var(--accent);font-weight:600;font-size:14px;border:1px solid var(--border);transition:all .2s;">ğŸ“˜ Documentation</a>
    <a href="https://developer.apple.com/documentation/corebluetooth/transferring-data-between-bluetooth-low-energy-devices" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:10px 16px;background:white;border-radius:10px;text-decoration:none;color:var(--accent);font-weight:600;font-size:14px;border:1px solid var(--border);transition:all .2s;">ğŸ’» Sample Code</a>
    <a href="https://developer.apple.com/videos/all-videos/?q=Core+Bluetooth" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:10px 16px;background:white;border-radius:10px;text-decoration:none;color:var(--accent);font-weight:600;font-size:14px;border:1px solid var(--border);transition:all .2s;">ğŸ¬ WWDC Sessions</a>
  </div>
</div>
</article>
</body></html>
