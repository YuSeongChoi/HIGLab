{"metadata":{"role":"project","title":"App Store Server API","category":"Building a Subscription App","categoryPathComponent":"Table-of-Contents"},"sections":[{"kind":"hero","estimatedTimeInMinutes":30,"content":[{"inlineContent":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"type":"text","text":"and handle real-time events with App Store Server Notifications."}],"type":"paragraph"}],"chapter":"Ring 9: App Store Server API","title":"App Store Server API"},{"kind":"tasks","tasks":[{"anchor":"Server-API-Overview","stepsSection":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Generate a JWT on the server to handle API authentication.","type":"text"}]}],"runtimePreview":null,"type":"step","caption":[],"code":"09-appstore-jwt.swift","media":null},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Call the subscription status query API."}]}],"runtimePreview":null,"type":"step","caption":[],"code":"09-appstore-api.swift","media":null}],"title":"Server API Overview","contentSection":[{"kind":"contentAndMedia","content":[{"inlineContent":[{"type":"text","text":"The App Store Server API allows you to query subscription status"},{"text":" ","type":"text"},{"text":"and receive real-time events like refunds and renewals from your server.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Key Endpoints:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Get Transaction History"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Get All Subscription Statuses"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Request a Test Notification","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"Authentication: App Store Connect API Key + JWT","type":"text"}]}],"mediaPosition":"trailing"}]},{"title":"Server Notifications V2","contentSection":[{"mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"App Store Server Notifications V2 delivers"},{"type":"text","text":" "},{"type":"text","text":"subscription events in real-time using JWS format."}]},{"inlineContent":[{"text":"Key Notification Types:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"SUBSCRIBED"},{"text":": New subscription","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"DID_RENEW"},{"type":"text","text":": Renewal success"}]}]},{"content":[{"inlineContent":[{"code":"DID_FAIL_TO_RENEW","type":"codeVoice"},{"text":": Renewal failure","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"EXPIRED","type":"codeVoice"},{"text":": Expiration","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"REFUND"},{"type":"text","text":": Refund"}]}]}],"type":"unorderedList"}],"kind":"contentAndMedia"}],"anchor":"Server-Notifications-V2","stepsSection":[{"type":"step","media":null,"code":"09-notification-handler.swift","runtimePreview":null,"content":[{"inlineContent":[{"text":"Parse the Server Notification payload.","type":"text"}],"type":"paragraph"}],"caption":[]},{"runtimePreview":null,"media":null,"type":"step","code":"09-event-processor.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement business logic based on notification types."}]}],"caption":[]}]},{"contentSection":[{"content":[{"inlineContent":[{"text":"Verify the JWS (JSON Web Signature) sent by App Store","type":"text"},{"text":" ","type":"text"},{"text":"to prevent tampering.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Verification is possible on both client and server:"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Client: StoreKit 2 verifies automatically","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Server: Apple certificate chain verification required","type":"text"}]}]}],"type":"unorderedList"}],"kind":"contentAndMedia","mediaPosition":"trailing"}],"stepsSection":[{"code":"09-jws-verifier.swift","type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Decode the JWS payload and verify the signature."}]}],"media":null,"runtimePreview":null,"caption":[]}],"anchor":"JWS-Verification","title":"JWS Verification"}]},{"assessments":[{"type":"multiple-choice","title":[{"inlineContent":[{"text":"What is the data format of App Store Server Notifications V2?","type":"text"}],"type":"paragraph"}],"content":[],"choices":[{"isCorrect":false,"justification":[{"inlineContent":[{"type":"text","text":"V2 uses a signed format for security."}],"type":"paragraph"}],"content":[{"inlineContent":[{"type":"text","text":"Plain JSON"}],"type":"paragraph"}]},{"justification":[{"inlineContent":[{"type":"text","text":"V2 is transmitted signed in JWS format,"},{"text":" ","type":"text"},{"text":"verified using Apple’s certificate chain.","type":"text"}],"type":"paragraph"}],"isCorrect":true,"content":[{"inlineContent":[{"type":"text","text":"JWS (JSON Web Signature)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Encrypted binary"}],"type":"paragraph"}],"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"text":"JWS is a Base64URL encoded text format.","type":"text"}]}]}]},{"type":"multiple-choice","title":[{"inlineContent":[{"text":"What should you do when receiving a DID_FAIL_TO_RENEW notification?","type":"text"}],"type":"paragraph"}],"content":[],"choices":[{"content":[{"inlineContent":[{"type":"text","text":"Immediately block user access."}],"type":"paragraph"}],"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Apple retries multiple times during the billing retry period."},{"type":"text","text":" "},{"text":"Immediate blocking leads to poor user experience.","type":"text"}]}]},{"isCorrect":true,"justification":[{"inlineContent":[{"type":"text","text":"According to HIG guidelines, provide a grace period"},{"type":"text","text":" "},{"type":"text","text":"and guide users to update their payment information."}],"type":"paragraph"}],"content":[{"inlineContent":[{"type":"text","text":"Apply a grace period and guide the user to update payment information."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Take no action."}]}],"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Users need appropriate guidance when renewal fails."}]}]}]},{"type":"multiple-choice","title":[{"inlineContent":[{"text":"What is required for App Store Server API authentication?","type":"text"}],"type":"paragraph"}],"content":[],"choices":[{"content":[{"type":"paragraph","inlineContent":[{"text":"App Store Connect login session","type":"text"}]}],"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"text":"The server API uses token-based authentication, not sessions.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"JWT generated with App Store Connect API Key","type":"text"}]}],"isCorrect":true,"justification":[{"type":"paragraph","inlineContent":[{"text":"Include a JWT signed with your Private Key in the Authorization header for authentication.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"User’s Apple ID","type":"text"}],"type":"paragraph"}],"isCorrect":false,"justification":[{"inlineContent":[{"type":"text","text":"The Server API authenticates with developer credentials."}],"type":"paragraph"}]}]}],"kind":"assessments","anchor":"Check-Your-Understanding"},{"abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"type":"text","text":" "},{"type":"text","text":"using Introductory Offers, Promotional Offers, and Offer Codes."}],"action":{"overridingTitle":"Get started","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers","type":"reference","overridingTitleInlineContent":[{"text":"Get started","type":"text"}],"isActive":true},"kind":"callToAction","featuredEyebrow":"Tutorial","title":"Subscription Discount Offers"}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore"},"schemaVersion":{"minor":3,"patch":0,"major":0},"kind":"project","variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/tutorials\/higstorekit\/09-appstore"]}],"hierarchy":{"paths":[["doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents","doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/$volume","doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-9:-App-Store-Server-API"]],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents","modules":[{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit","sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit#What-is-StoreKit-2"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-1:-Understanding-StoreKit-2"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products","sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products#Loading-Products"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-2:-Loading-Products"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow","sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow#Purchase-Handling","kind":"task"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-3:-Purchase-Flow"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status","sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status#Checking-Subscription-Status"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-4:-Subscription-Management"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI","sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI#Paywall-Design","kind":"task"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-5:-Paywall-UI"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions","sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Groups-and-Levels","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Upgrades-Downgrades","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Renewal-Status","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Check-Your-Understanding","kind":"assessment"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-7:-Advanced-Subscription-Management"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing","sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Understanding-Family-Sharing","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#UI-Branching-by-Ownership-Type","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Handling-Family-Sharing-Cancellation","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Check-Your-Understanding","kind":"assessment"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-8:-Family-Sharing"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore","sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-API-Overview"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-Notifications-V2"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#JWS-Verification"},{"kind":"assessment","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Check-Your-Understanding"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-9:-App-Store-Server-API"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers","sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Introductory-Offers"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Promotional-Offers"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Codes"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Strategy-HIG-Guidelines"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Check-Your-Understanding","kind":"assessment"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-10:-Subscription-Discount-Offers"},{"projects":[{"sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#StoreKit-Configuration-File"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Writing-Unit-Tests"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Sandbox-Testing"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Error-Scenario-Testing"},{"kind":"assessment","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Check-Your-Understanding"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-11:-StoreKit-Testing"}]},"references":{"09-event-processor.swift":{"type":"file","fileName":"SubscriptionEventProcessor.swift","content":["import Foundation","","\/\/\/ 구독 이벤트 처리기","actor SubscriptionEventProcessor {","    ","    private let database: SubscriptionDatabase","    private let notificationService: PushNotificationService","    ","    init(database: SubscriptionDatabase, notificationService: PushNotificationService) {","        self.database = database","        self.notificationService = notificationService","    }","    ","    \/\/\/ 알림 타입에 따른 처리","    func process(_ notification: NotificationHandler.DecodedNotification) async {","        let userId = await database.getUserId(for: notification.data.bundleId)","        ","        switch notification.notificationType {","        case .subscribed:","            await handleSubscribed(notification, userId: userId)","            ","        case .didRenew:","            await handleRenewal(notification, userId: userId)","            ","        case .didFailToRenew:","            await handleRenewalFailure(notification, userId: userId)","            ","        case .expired:","            await handleExpired(notification, userId: userId)","            ","        case .refund:","            await handleRefund(notification, userId: userId)","            ","        case .didChangeRenewalPref:","            await handlePlanChange(notification, userId: userId)","            ","        default:","            print(\"Unhandled notification: \\(notification.notificationType)\")","        }","    }","    ","    \/\/ MARK: - Event Handlers","    ","    private func handleSubscribed(","        _ notification: NotificationHandler.DecodedNotification,","        userId: String?","    ) async {","        guard let userId else { return }","        ","        \/\/ 구독 상태 업데이트","        await database.updateSubscriptionStatus(","            userId: userId,","            status: .active,","            expirationDate: nil \/\/ 트랜잭션에서 추출","        )","        ","        \/\/ 환영 이메일\/푸시","        await notificationService.sendWelcome(to: userId)","    }","    ","    private func handleRenewal(","        _ notification: NotificationHandler.DecodedNotification,","        userId: String?","    ) async {","        guard let userId else { return }","        ","        await database.updateSubscriptionStatus(","            userId: userId,","            status: .active,","            expirationDate: nil","        )","    }","    ","    private func handleRenewalFailure(","        _ notification: NotificationHandler.DecodedNotification,","        userId: String?","    ) async {","        guard let userId else { return }","        ","        \/\/ 유예 기간 적용","        let gracePeriodEnd = Date().addingTimeInterval(7 * 24 * 60 * 60)","        ","        await database.updateSubscriptionStatus(","            userId: userId,","            status: .gracePeriod,","            expirationDate: gracePeriodEnd","        )","        ","        \/\/ 결제 업데이트 안내 푸시","        await notificationService.sendPaymentUpdateReminder(to: userId)","    }","    ","    private func handleExpired(","        _ notification: NotificationHandler.DecodedNotification,","        userId: String?","    ) async {","        guard let userId else { return }","        ","        await database.updateSubscriptionStatus(","            userId: userId,","            status: .expired,","            expirationDate: Date()","        )","        ","        \/\/ 재구독 유도 메시지","        await notificationService.sendResubscribeReminder(to: userId)","    }","    ","    private func handleRefund(","        _ notification: NotificationHandler.DecodedNotification,","        userId: String?","    ) async {","        guard let userId else { return }","        ","        await database.updateSubscriptionStatus(","            userId: userId,","            status: .refunded,","            expirationDate: Date()","        )","    }","    ","    private func handlePlanChange(","        _ notification: NotificationHandler.DecodedNotification,","        userId: String?","    ) async {","        guard let userId else { return }","        ","        let isUpgrade = notification.subtype == .upgrade","        let message = isUpgrade ? \"플랜이 업그레이드되었습니다!\" : \"다음 갱신 시 플랜이 변경됩니다.\"","        ","        await notificationService.sendPlanChangeNotification(to: userId, message: message)","    }","}","","\/\/ MARK: - Protocols (구현 필요)","","protocol SubscriptionDatabase {","    func getUserId(for bundleId: String) async -> String?","    func updateSubscriptionStatus(userId: String, status: SubscriptionStatus, expirationDate: Date?) async","}","","protocol PushNotificationService {","    func sendWelcome(to userId: String) async","    func sendPaymentUpdateReminder(to userId: String) async","    func sendResubscribeReminder(to userId: String) async","    func sendPlanChangeNotification(to userId: String, message: String) async","}","","enum SubscriptionStatus {","    case active","    case gracePeriod","    case expired","    case refunded","}"],"fileType":"swift","syntax":"swift","identifier":"09-event-processor.swift","highlights":[]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-3:-Purchase-Flow":{"type":"topic","kind":"article","title":"Ring 3: Purchase Flow","role":"article","url":"\/tutorials\/table-of-contents\/ring-3:-purchase-flow","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-3:-Purchase-Flow","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing":{"type":"topic","kind":"project","title":"StoreKit Testing","role":"project","estimatedTime":"25min","url":"\/tutorials\/higstorekit\/11-testing","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing","abstract":[{"text":"Thoroughly test in-app purchase functionality using","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Xcode’s StoreKit Testing and Sandbox environment."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore","title":"App Store Server API","kind":"project","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"text":"and handle real-time events with App Store Server Notifications.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/09-appstore","estimatedTime":"30min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions","title":"Advanced Subscription Management","kind":"project","abstract":[{"type":"text","text":"Implement all subscription management features needed for a real service,"},{"type":"text","text":" "},{"text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/07-subscriptions","estimatedTime":"25min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-2:-Loading-Products":{"type":"topic","kind":"article","title":"Ring 2: Loading Products","role":"article","url":"\/tutorials\/table-of-contents\/ring-2:-loading-products","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-2:-Loading-Products","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Subscription-Groups-and-Levels":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Groups-and-Levels","title":"Subscription Groups and Levels","kind":"section","abstract":[{"type":"text","text":"Implement all subscription management features needed for a real service,"},{"text":" ","type":"text"},{"text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/07-subscriptions#Subscription-Groups-and-Levels","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-11:-StoreKit-Testing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-11:-StoreKit-Testing","title":"Ring 11: StoreKit Testing","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-11:-storekit-testing","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Check-Your-Understanding":{"url":"\/tutorials\/higstorekit\/07-subscriptions#Check-Your-Understanding","title":"Check Your Understanding","titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"type":"link","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Check-Your-Understanding"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Error-Scenario-Testing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Error-Scenario-Testing","title":"Error Scenario Testing","kind":"section","abstract":[{"text":"Thoroughly test in-app purchase functionality using","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Xcode’s StoreKit Testing and Sandbox environment."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#Error-Scenario-Testing","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Subscription-Upgrades-Downgrades":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Upgrades-Downgrades","title":"Subscription Upgrades & Downgrades","kind":"section","abstract":[{"type":"text","text":"Implement all subscription management features needed for a real service,"},{"type":"text","text":" "},{"type":"text","text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/07-subscriptions#Subscription-Upgrades-Downgrades","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Subscription-Renewal-Status":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Renewal-Status","title":"Subscription Renewal Status","kind":"section","abstract":[{"text":"Implement all subscription management features needed for a real service,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/07-subscriptions#Subscription-Renewal-Status","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Promotional-Offers":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Promotional-Offers","title":"Promotional Offers","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"type":"text","text":" "},{"type":"text","text":"using Introductory Offers, Promotional Offers, and Offer Codes."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Promotional-Offers","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-10:-Subscription-Discount-Offers":{"type":"topic","kind":"article","title":"Ring 10: Subscription Discount Offers","role":"article","url":"\/tutorials\/table-of-contents\/ring-10:-subscription-discount-offers","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-10:-Subscription-Discount-Offers","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#Understanding-Family-Sharing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Understanding-Family-Sharing","title":"Understanding Family Sharing","kind":"section","abstract":[{"text":"Enable up to 6 family members to use the app","type":"text"},{"type":"text","text":" "},{"text":"with a single subscription through Family Sharing.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/08-familysharing#Understanding-Family-Sharing","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-9:-App-Store-Server-API":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-9:-App-Store-Server-API","title":"Ring 9: App Store Server API","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-9:-app-store-server-api","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/01-Understanding-StoreKit#What-is-StoreKit-2":{"type":"section","kind":"section","title":"What is StoreKit 2?","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/01-understanding-storekit#What-is-StoreKit-2","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit#What-is-StoreKit-2","abstract":[{"type":"text","text":"Learn the core concepts of StoreKit 2 and HIG in-app purchase guidelines."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#JWS-Verification":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#JWS-Verification","title":"JWS Verification","kind":"section","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"text":" ","type":"text"},{"type":"text","text":"and handle real-time events with App Store Server Notifications."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/09-appstore#JWS-Verification","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/02-Loading-Products#Loading-Products":{"type":"section","kind":"section","title":"Loading Products","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/02-loading-products#Loading-Products","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products#Loading-Products","abstract":[{"type":"text","text":"Load product information configured in App Store Connect."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#Server-API-Overview":{"type":"section","kind":"section","title":"Server API Overview","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/09-appstore#Server-API-Overview","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-API-Overview","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"type":"text","text":"and handle real-time events with App Store Server Notifications."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Check-Your-Understanding":{"url":"\/tutorials\/higstorekit\/10-subscription-offers#Check-Your-Understanding","title":"Check Your Understanding","titleInlineContent":[{"type":"text","text":"Check Your Understanding"}],"type":"link","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Check-Your-Understanding"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Offer-Strategy-HIG-Guidelines":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Strategy-HIG-Guidelines","title":"Offer Strategy & HIG Guidelines","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"text":" ","type":"text"},{"text":"using Introductory Offers, Promotional Offers, and Offer Codes.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Offer-Strategy-HIG-Guidelines","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-5:-Paywall-UI":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-5:-Paywall-UI","title":"Ring 5: Paywall UI","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-5:-paywall-ui","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#UI-Branching-by-Ownership-Type":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#UI-Branching-by-Ownership-Type","title":"UI Branching by Ownership Type","kind":"section","abstract":[{"text":"Enable up to 6 family members to use the app","type":"text"},{"type":"text","text":" "},{"type":"text","text":"with a single subscription through Family Sharing."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/08-familysharing#UI-Branching-by-Ownership-Type","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/01-Understanding-StoreKit":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit","title":"Understanding StoreKit 2","kind":"project","abstract":[{"text":"Learn the core concepts of StoreKit 2 and HIG in-app purchase guidelines.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/01-understanding-storekit","estimatedTime":"10min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#Server-Notifications-V2":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-Notifications-V2","title":"Server Notifications V2","kind":"section","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"text":"and handle real-time events with App Store Server Notifications.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/09-appstore#Server-Notifications-V2","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/05-Paywall-UI":{"type":"topic","kind":"project","title":"HIG-Compliant Paywall UI","role":"project","estimatedTime":"20min","url":"\/tutorials\/higstorekit\/05-paywall-ui","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI","abstract":[{"type":"text","text":"Design a paywall screen that follows Apple HIG guidelines."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/04-Subscription-Status#Checking-Subscription-Status":{"type":"section","kind":"section","title":"Checking Subscription Status","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/04-subscription-status#Checking-Subscription-Status","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status#Checking-Subscription-Status","abstract":[{"type":"text","text":"Check subscription status and handle renewals."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Offer-Codes":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Codes","title":"Offer Codes","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"type":"text","text":" "},{"text":"using Introductory Offers, Promotional Offers, and Offer Codes.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Offer-Codes","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers","title":"Subscription Discount Offers","kind":"project","abstract":[{"text":"Implement new user acquisition and churn prevention strategies","type":"text"},{"type":"text","text":" "},{"text":"using Introductory Offers, Promotional Offers, and Offer Codes.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/10-subscription-offers","estimatedTime":"30min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/03-Purchase-Flow":{"type":"topic","kind":"project","title":"Implementing Purchase Flow","role":"project","estimatedTime":"15min","url":"\/tutorials\/higstorekit\/03-purchase-flow","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow","abstract":[{"type":"text","text":"Implement the complete flow for users to purchase products."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Sandbox-Testing":{"type":"section","kind":"section","title":"Sandbox Testing","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#Sandbox-Testing","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Sandbox-Testing","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"type":"text","text":" "},{"type":"text","text":"Xcode’s StoreKit Testing and Sandbox environment."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/05-Paywall-UI#Paywall-Design":{"type":"section","kind":"section","title":"Paywall Design","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/05-paywall-ui#Paywall-Design","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI#Paywall-Design","abstract":[{"type":"text","text":"Design a paywall screen that follows Apple HIG guidelines."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/03-Purchase-Flow#Purchase-Handling":{"type":"section","kind":"section","title":"Purchase Handling","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/03-purchase-flow#Purchase-Handling","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow#Purchase-Handling","abstract":[{"type":"text","text":"Implement the complete flow for users to purchase products."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#Check-Your-Understanding":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Check-Your-Understanding","titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"type":"link","title":"Check Your Understanding","url":"\/tutorials\/higstorekit\/08-familysharing#Check-Your-Understanding"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-7:-Advanced-Subscription-Management":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-7:-Advanced-Subscription-Management","title":"Ring 7: Advanced Subscription Management","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-7:-advanced-subscription-management","type":"topic"},"09-notification-handler.swift":{"fileType":"swift","type":"file","fileName":"NotificationHandler.swift","content":["import Foundation","","\/\/\/ App Store Server Notification V2 핸들러","struct NotificationHandler {","    ","    \/\/\/ Notification V2 페이로드","    struct SignedPayload: Codable {","        let signedPayload: String","    }","    ","    \/\/\/ 디코딩된 알림","    struct DecodedNotification: Codable {","        let notificationType: NotificationType","        let subtype: NotificationSubtype?","        let data: NotificationData","        let notificationUUID: String","        let signedDate: Int","        ","        enum NotificationType: String, Codable {","            case subscribed = \"SUBSCRIBED\"","            case didRenew = \"DID_RENEW\"","            case didFailToRenew = \"DID_FAIL_TO_RENEW\"","            case expired = \"EXPIRED\"","            case gracePeriodExpired = \"GRACE_PERIOD_EXPIRED\"","            case didChangeRenewalPref = \"DID_CHANGE_RENEWAL_PREF\"","            case didChangeRenewalStatus = \"DID_CHANGE_RENEWAL_STATUS\"","            case refund = \"REFUND\"","            case refundDeclined = \"REFUND_DECLINED\"","            case consumptionRequest = \"CONSUMPTION_REQUEST\"","            case renewalExtended = \"RENEWAL_EXTENDED\"","            case revoke = \"REVOKE\"","            case test = \"TEST\"","        }","        ","        enum NotificationSubtype: String, Codable {","            case initialBuy = \"INITIAL_BUY\"","            case resubscribe = \"RESUBSCRIBE\"","            case upgrade = \"UPGRADE\"","            case downgrade = \"DOWNGRADE\"","            case autoRenewEnabled = \"AUTO_RENEW_ENABLED\"","            case autoRenewDisabled = \"AUTO_RENEW_DISABLED\"","            case voluntary = \"VOLUNTARY\"","            case billingRetry = \"BILLING_RETRY\"","            case priceIncrease = \"PRICE_INCREASE\"","            case gracePeriod = \"GRACE_PERIOD\"","            case billingRecovery = \"BILLING_RECOVERY\"","        }","    }","    ","    struct NotificationData: Codable {","        let bundleId: String","        let environment: String","        let signedTransactionInfo: String","        let signedRenewalInfo: String?","    }","    ","    \/\/\/ JWS 페이로드에서 알림 디코딩","    func decode(signedPayload: String) throws -> DecodedNotification {","        let parts = signedPayload.split(separator: \".\")","        guard parts.count == 3 else {","            throw NotificationError.invalidFormat","        }","        ","        let payloadPart = String(parts[1])","        guard let payloadData = Data(base64URLEncoded: payloadPart) else {","            throw NotificationError.decodingFailed","        }","        ","        return try JSONDecoder().decode(DecodedNotification.self, from: payloadData)","    }","    ","    enum NotificationError: Error {","        case invalidFormat","        case decodingFailed","        case signatureInvalid","    }","}","","extension Data {","    init?(base64URLEncoded string: String) {","        var base64 = string","            .replacingOccurrences(of: \"-\", with: \"+\")","            .replacingOccurrences(of: \"_\", with: \"\/\")","        ","        let remainder = base64.count % 4","        if remainder > 0 {","            base64 += String(repeating: \"=\", count: 4 - remainder)","        }","        ","        self.init(base64Encoded: base64)","    }","}"],"highlights":[],"syntax":"swift","identifier":"09-notification-handler.swift"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/04-Subscription-Status":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status","title":"Managing Subscription Status","kind":"project","abstract":[{"type":"text","text":"Check subscription status and handle renewals."}],"role":"project","url":"\/tutorials\/higstorekit\/04-subscription-status","estimatedTime":"15min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Check-Your-Understanding":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Check-Your-Understanding","titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"type":"link","url":"\/tutorials\/higstorekit\/11-testing#Check-Your-Understanding","title":"Check Your Understanding"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/02-Loading-Products":{"type":"topic","kind":"project","title":"Loading Products","role":"project","estimatedTime":"15min","url":"\/tutorials\/higstorekit\/02-loading-products","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products","abstract":[{"text":"Load product information configured in App Store Connect.","type":"text"}]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-1:-Understanding-StoreKit-2":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-1:-Understanding-StoreKit-2","title":"Ring 1: Understanding StoreKit 2","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-1:-understanding-storekit-2","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-4:-Subscription-Management":{"type":"topic","kind":"article","title":"Ring 4: Subscription Management","role":"article","url":"\/tutorials\/table-of-contents\/ring-4:-subscription-management","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-4:-Subscription-Management","abstract":[]},"09-appstore-jwt.swift":{"fileType":"swift","type":"file","fileName":"AppStoreJWT.swift","content":["import Foundation","import CryptoKit","","\/\/\/ App Store Server API JWT 생성","struct AppStoreJWT {","    ","    let keyID: String        \/\/ App Store Connect Key ID","    let issuerID: String     \/\/ App Store Connect Issuer ID  ","    let bundleID: String     \/\/ 앱 번들 ID","    let privateKey: P256.Signing.PrivateKey","    ","    \/\/\/ JWT 토큰 생성","    func generateToken() throws -> String {","        let header = Header(kid: keyID)","        let payload = Payload(","            iss: issuerID,","            iat: Int(Date().timeIntervalSince1970),","            exp: Int(Date().addingTimeInterval(3600).timeIntervalSince1970),","            aud: \"appstoreconnect-v1\",","            bid: bundleID","        )","        ","        \/\/ Header + Payload를 Base64URL 인코딩","        let headerData = try JSONEncoder().encode(header)","        let payloadData = try JSONEncoder().encode(payload)","        ","        let headerString = headerData.base64URLEncodedString()","        let payloadString = payloadData.base64URLEncodedString()","        ","        \/\/ 서명 생성","        let signingInput = \"\\(headerString).\\(payloadString)\"","        let signature = try privateKey.signature(for: Data(signingInput.utf8))","        let signatureString = signature.rawRepresentation.base64URLEncodedString()","        ","        return \"\\(signingInput).\\(signatureString)\"","    }","    ","    \/\/ MARK: - Types","    ","    struct Header: Codable {","        let alg = \"ES256\"","        let typ = \"JWT\"","        let kid: String","    }","    ","    struct Payload: Codable {","        let iss: String  \/\/ issuer ID","        let iat: Int     \/\/ issued at","        let exp: Int     \/\/ expiration","        let aud: String  \/\/ audience","        let bid: String  \/\/ bundle ID","    }","}","","\/\/ MARK: - Base64URL","","extension Data {","    func base64URLEncodedString() -> String {","        base64EncodedString()","            .replacingOccurrences(of: \"+\", with: \"-\")","            .replacingOccurrences(of: \"\/\", with: \"_\")","            .replacingOccurrences(of: \"=\", with: \"\")","    }","}"],"highlights":[],"syntax":"swift","identifier":"09-appstore-jwt.swift"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents","title":"Building a Subscription App with StoreKit 2","kind":"overview","abstract":[{"type":"text","text":"Implement a subscription payment system using"},{"type":"text","text":" "},{"text":"StoreKit 2’s modern async\/await APIs.","type":"text"}],"role":"overview","url":"\/tutorials\/table-of-contents","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Writing-Unit-Tests":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Writing-Unit-Tests","title":"Writing Unit Tests","kind":"section","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"type":"text","text":" "},{"type":"text","text":"Xcode’s StoreKit Testing and Sandbox environment."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#Writing-Unit-Tests","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#Handling-Family-Sharing-Cancellation":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Handling-Family-Sharing-Cancellation","title":"Handling Family Sharing Cancellation","kind":"section","abstract":[{"text":"Enable up to 6 family members to use the app","type":"text"},{"type":"text","text":" "},{"type":"text","text":"with a single subscription through Family Sharing."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/08-familysharing#Handling-Family-Sharing-Cancellation","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#StoreKit-Configuration-File":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#StoreKit-Configuration-File","title":"StoreKit Configuration File","kind":"section","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"text":" ","type":"text"},{"type":"text","text":"Xcode’s StoreKit Testing and Sandbox environment."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#StoreKit-Configuration-File","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-8:-Family-Sharing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-8:-Family-Sharing","title":"Ring 8: Family Sharing","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-8:-family-sharing","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#Check-Your-Understanding":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Check-Your-Understanding","titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"type":"link","title":"Check Your Understanding","url":"\/tutorials\/higstorekit\/09-appstore#Check-Your-Understanding"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Introductory-Offers":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Introductory-Offers","title":"Introductory Offers","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"text":" ","type":"text"},{"type":"text","text":"using Introductory Offers, Promotional Offers, and Offer Codes."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Introductory-Offers","type":"section"},"09-jws-verifier.swift":{"fileType":"swift","type":"file","content":["import Foundation","import CryptoKit","import X509  \/\/ swift-certificates 패키지 필요","","\/\/\/ JWS 서명 검증기","struct JWSVerifier {","    ","    \/\/\/ Apple 루트 인증서 (Production)","    static let appleRootCertURL = URL(","        string: \"https:\/\/www.apple.com\/certificateauthority\/AppleRootCA-G3.cer\"","    )!","    ","    \/\/\/ JWS 서명 검증","    func verify(jws: String) async throws -> Bool {","        let parts = jws.split(separator: \".\")","        guard parts.count == 3 else {","            throw VerificationError.invalidFormat","        }","        ","        let headerPart = String(parts[0])","        let payloadPart = String(parts[1])","        let signaturePart = String(parts[2])","        ","        \/\/ 1. 헤더에서 인증서 체인 추출","        let header = try decodeHeader(headerPart)","        ","        \/\/ 2. 인증서 체인 검증","        guard try await verifyCertificateChain(header.x5c) else {","            throw VerificationError.certificateChainInvalid","        }","        ","        \/\/ 3. 서명 검증","        let signingInput = \"\\(headerPart).\\(payloadPart)\"","        let leafCert = try extractLeafCertificate(from: header.x5c)","        ","        return try verifySignature(","            input: signingInput,","            signature: signaturePart,","            publicKey: leafCert.publicKey","        )","    }","    ","    \/\/\/ JWS 페이로드 디코딩 (검증 후)","    func decode<T: Decodable>(_ type: T.Type, from jws: String) throws -> T {","        let parts = jws.split(separator: \".\")","        guard parts.count == 3,","              let payloadData = Data(base64URLEncoded: String(parts[1])) else {","            throw VerificationError.invalidFormat","        }","        ","        return try JSONDecoder().decode(type, from: payloadData)","    }","    ","    \/\/ MARK: - Private","    ","    private struct JWSHeader: Codable {","        let alg: String","        let x5c: [String]  \/\/ 인증서 체인 (Base64)","    }","    ","    private func decodeHeader(_ base64: String) throws -> JWSHeader {","        guard let data = Data(base64URLEncoded: base64) else {","            throw VerificationError.invalidFormat","        }","        return try JSONDecoder().decode(JWSHeader.self, from: data)","    }","    ","    private func verifyCertificateChain(_ chain: [String]) async throws -> Bool {","        \/\/ 인증서 체인의 각 단계를 검증","        \/\/ 1. Leaf cert → Intermediate cert 서명 확인","        \/\/ 2. Intermediate cert → Apple Root cert 서명 확인","        \/\/ 3. Apple Root cert가 신뢰할 수 있는지 확인","        ","        \/\/ 실제 구현에서는 swift-certificates 또는 Security.framework 사용","        \/\/ 여기서는 개념적인 구조만 표시","        ","        guard chain.count >= 2 else {","            return false","        }","        ","        \/\/ Apple 루트 인증서와 체인의 마지막 인증서 비교","        \/\/ ... 구현 생략 ...","        ","        return true","    }","    ","    private func extractLeafCertificate(from chain: [String]) throws -> LeafCertificate {","        guard let leafCertBase64 = chain.first,","              let certData = Data(base64Encoded: leafCertBase64) else {","            throw VerificationError.certificateChainInvalid","        }","        ","        \/\/ X.509 인증서에서 공개키 추출","        \/\/ swift-certificates 패키지 사용","        return LeafCertificate(publicKey: certData)","    }","    ","    private func verifySignature(","        input: String,","        signature: String,","        publicKey: Data","    ) throws -> Bool {","        guard let signatureData = Data(base64URLEncoded: signature) else {","            throw VerificationError.invalidSignature","        }","        ","        \/\/ ES256 서명 검증","        let inputData = Data(input.utf8)","        ","        \/\/ P256 공개키로 서명 검증","        \/\/ ... CryptoKit 또는 Security.framework 사용 ...","        ","        return true","    }","    ","    struct LeafCertificate {","        let publicKey: Data","    }","    ","    enum VerificationError: Error {","        case invalidFormat","        case certificateChainInvalid","        case invalidSignature","        case expired","    }","}"],"fileName":"JWSVerifier.swift","highlights":[],"syntax":"swift","identifier":"09-jws-verifier.swift"},"09-appstore-api.swift":{"highlights":[],"fileName":"AppStoreAPI.swift","content":["import Foundation","","\/\/\/ App Store Server API 클라이언트","actor AppStoreServerAPI {","    ","    private let jwtGenerator: AppStoreJWT","    private let environment: Environment","    ","    enum Environment {","        case sandbox","        case production","        ","        var baseURL: String {","            switch self {","            case .sandbox:","                return \"https:\/\/api.storekit-sandbox.itunes.apple.com\"","            case .production:","                return \"https:\/\/api.storekit.itunes.apple.com\"","            }","        }","    }","    ","    init(jwtGenerator: AppStoreJWT, environment: Environment = .production) {","        self.jwtGenerator = jwtGenerator","        self.environment = environment","    }","    ","    \/\/\/ 구독 상태 조회","    func getAllSubscriptionStatuses(","        transactionId: String","    ) async throws -> SubscriptionStatusResponse {","        let url = URL(string: \"\\(environment.baseURL)\/inApps\/v1\/subscriptions\/\\(transactionId)\")!","        let token = try jwtGenerator.generateToken()","        ","        var request = URLRequest(url: url)","        request.setValue(\"Bearer \\(token)\", forHTTPHeaderField: \"Authorization\")","        ","        let (data, response) = try await URLSession.shared.data(for: request)","        ","        guard let httpResponse = response as? HTTPURLResponse,","              httpResponse.statusCode == 200 else {","            throw APIError.invalidResponse","        }","        ","        return try JSONDecoder().decode(SubscriptionStatusResponse.self, from: data)","    }","    ","    \/\/\/ 트랜잭션 히스토리 조회","    func getTransactionHistory(","        transactionId: String,","        revision: String? = nil","    ) async throws -> TransactionHistoryResponse {","        var urlComponents = URLComponents(","            string: \"\\(environment.baseURL)\/inApps\/v1\/history\/\\(transactionId)\"","        )!","        ","        if let revision = revision {","            urlComponents.queryItems = [URLQueryItem(name: \"revision\", value: revision)]","        }","        ","        let token = try jwtGenerator.generateToken()","        var request = URLRequest(url: urlComponents.url!)","        request.setValue(\"Bearer \\(token)\", forHTTPHeaderField: \"Authorization\")","        ","        let (data, _) = try await URLSession.shared.data(for: request)","        return try JSONDecoder().decode(TransactionHistoryResponse.self, from: data)","    }","    ","    \/\/ MARK: - Response Types","    ","    struct SubscriptionStatusResponse: Codable {","        let environment: String","        let bundleId: String","        let data: [SubscriptionGroupStatus]","    }","    ","    struct SubscriptionGroupStatus: Codable {","        let subscriptionGroupIdentifier: String","        let lastTransactions: [LastTransaction]","    }","    ","    struct LastTransaction: Codable {","        let status: Int","        let signedTransactionInfo: String","        let signedRenewalInfo: String","    }","    ","    struct TransactionHistoryResponse: Codable {","        let revision: String","        let hasMore: Bool","        let signedTransactions: [String]","    }","    ","    enum APIError: Error {","        case invalidResponse","        case unauthorized","    }","}"],"type":"file","fileType":"swift","syntax":"swift","identifier":"09-appstore-api.swift"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing":{"type":"topic","kind":"project","title":"Supporting Family Sharing","role":"project","estimatedTime":"20min","url":"\/tutorials\/higstorekit\/08-familysharing","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing","abstract":[{"type":"text","text":"Enable up to 6 family members to use the app"},{"type":"text","text":" "},{"type":"text","text":"with a single subscription through Family Sharing."}]}}}