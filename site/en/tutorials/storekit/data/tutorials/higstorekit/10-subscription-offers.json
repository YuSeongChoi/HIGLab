{"kind":"project","schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[{"title":"Subscription Discount Offers","content":[{"type":"paragraph","inlineContent":[{"text":"Implement new user acquisition and churn prevention strategies","type":"text"},{"text":" ","type":"text"},{"text":"using Introductory Offers, Promotional Offers, and Offer Codes.","type":"text"}]}],"chapter":"Ring 10: Subscription Discount Offers","estimatedTimeInMinutes":30,"kind":"hero"},{"kind":"tasks","tasks":[{"anchor":"Introductory-Offers","title":"Introductory Offers","contentSection":[{"mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"text":"Learn how to offer first-payment discounts, free trials,","type":"text"},{"text":" ","type":"text"},{"text":"and upfront discounts to new subscribers.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Offer Types:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"Free Trial","type":"text"}]},{"text":": Free trial period","type":"text"}]}]},{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Pay As You Go"}],"type":"strong"},{"type":"text","text":": Start with a discounted price"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Pay Up Front"}]},{"type":"text","text":": Discounted upfront payment"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Eligibility: Users subscribing to the subscription group for the first time"}]}],"kind":"contentAndMedia"}],"stepsSection":[{"media":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement logic to check and display Introductory Offer eligibility."}]}],"caption":[],"code":"10-intro-offer-manager.swift","runtimePreview":null,"type":"step"},{"type":"step","code":"10-intro-offer-view.swift","caption":[],"media":null,"content":[{"type":"paragraph","inlineContent":[{"text":"Implement UI to display offer information on the paywall.","type":"text"}]}],"runtimePreview":null}]},{"anchor":"Promotional-Offers","title":"Promotional Offers","contentSection":[{"mediaPosition":"trailing","content":[{"inlineContent":[{"type":"text","text":"Provide special discounts to existing or churned subscribers."},{"text":" ","type":"text"},{"text":"Security is enhanced as signatures must be generated on the server.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Use Cases:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Retention offers before subscription cancellation"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Re-acquisition of expired subscribers","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Win-back campaigns"}],"type":"paragraph"}]}]}],"kind":"contentAndMedia"}],"stepsSection":[{"runtimePreview":null,"type":"step","media":null,"content":[{"inlineContent":[{"type":"text","text":"Load Promotional Offers configured in App Store Connect."}],"type":"paragraph"}],"code":"10-promo-offer-manager.swift","caption":[]},{"type":"step","media":null,"code":"10-offer-signer.swift","runtimePreview":null,"content":[{"inlineContent":[{"type":"text","text":"Implement code to generate offer signatures on the server."}],"type":"paragraph"}],"caption":[]},{"type":"step","media":null,"code":"10-promo-purchase.swift","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"text":"Proceed with the purchase using the signed offer.","type":"text"}]}],"caption":[]}]},{"anchor":"Offer-Codes","contentSection":[{"mediaPosition":"trailing","content":[{"inlineContent":[{"type":"text","text":"Distribute codes generated in App Store Connect to users"},{"type":"text","text":" "},{"type":"text","text":"and accept code input within the app to apply discounts."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Distribution Channels:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Email marketing campaigns","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Partnership promotions","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Influencer collaborations"}],"type":"paragraph"}]}],"type":"unorderedList"}],"kind":"contentAndMedia"}],"stepsSection":[{"caption":[],"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement offer code input UI and processing logic."}]}],"media":null,"type":"step","code":"10-offer-code-view.swift"},{"media":null,"code":"10-offer-code-redemption.swift","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Display the system code input sheet using presentOfferCodeRedeemSheet."}]}],"caption":[],"type":"step"}],"title":"Offer Codes"},{"anchor":"Offer-Strategy-HIG-Guidelines","stepsSection":[{"caption":[],"type":"step","runtimePreview":null,"code":"10-offer-badge-view.swift","media":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement an HIG-compliant offer display component."}]}]}],"contentSection":[{"kind":"contentAndMedia","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Learn effective offer strategies and UX design methods"},{"type":"text","text":" "},{"type":"text","text":"that comply with Apple HIG guidelines."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"HIG Core Principles:"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Clearly display offer terms"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Provide comparison between regular and discounted prices","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Inform price after offer ends","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}],"mediaPosition":"trailing"}],"title":"Offer Strategy & HIG Guidelines"}]},{"anchor":"Check-Your-Understanding","assessments":[{"choices":[{"content":[{"inlineContent":[{"type":"text","text":"Users subscribing to the subscription group for the first time"}],"type":"paragraph"}],"isCorrect":true,"justification":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Introductory Offers can only be used once per subscription group."},{"type":"text","text":" "},{"type":"text","text":"Users must not have previously subscribed to the same group."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"All users who install the app for the first time"}]}],"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Eligibility is determined by subscription group history, not app installation."}]}]},{"justification":[{"type":"paragraph","inlineContent":[{"text":"For previous subscribers, you should use Promotional Offers instead.","type":"text"}]}],"content":[{"type":"paragraph","inlineContent":[{"text":"Users who cancelled their subscription","type":"text"}]}],"isCorrect":false}],"title":[{"inlineContent":[{"text":"Who can receive an Introductory Offer?","type":"text"}],"type":"paragraph"}],"type":"multiple-choice","content":[]},{"title":[{"type":"paragraph","inlineContent":[{"text":"What is required for a Promotional Offer purchase?","type":"text"}]}],"choices":[{"isCorrect":false,"content":[{"type":"paragraph","inlineContent":[{"text":"Only the offer ID is needed.","type":"text"}]}],"justification":[{"type":"paragraph","inlineContent":[{"text":"Additional verification is required for security.","type":"text"}]}]},{"isCorrect":true,"content":[{"inlineContent":[{"text":"A signature generated on the server","type":"text"}],"type":"paragraph"}],"justification":[{"type":"paragraph","inlineContent":[{"text":"Promotional Offers require a server-generated signature","type":"text"},{"text":" ","type":"text"},{"text":"to prevent abuse.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The userâ€™s Apple ID password"}],"type":"paragraph"}],"isCorrect":false,"justification":[{"inlineContent":[{"type":"text","text":"Payment authentication is handled automatically by StoreKit."}],"type":"paragraph"}]}],"content":[],"type":"multiple-choice"},{"type":"multiple-choice","title":[{"inlineContent":[{"type":"text","text":"How do you use an Offer Code in the app?"}],"type":"paragraph"}],"content":[],"choices":[{"content":[{"inlineContent":[{"type":"text","text":"Validate the code directly and apply the discount."}],"type":"paragraph"}],"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"text":"Code validation and application are handled by Apple.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Call presentOfferCodeRedeemSheet.","type":"text"}],"type":"paragraph"}],"isCorrect":true,"justification":[{"inlineContent":[{"type":"text","text":"Use the system sheet to securely receive code input,"},{"type":"text","text":" "},{"type":"text","text":"and Apple handles validation and application."}],"type":"paragraph"}]},{"isCorrect":false,"content":[{"inlineContent":[{"text":"Can only be applied in App Store Connect.","type":"text"}],"type":"paragraph"}],"justification":[{"inlineContent":[{"type":"text","text":"You can also provide a code input UI within the app."}],"type":"paragraph"}]}]},{"type":"multiple-choice","content":[],"choices":[{"isCorrect":false,"justification":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Regular price and comparison information should also be provided."}]}],"content":[{"inlineContent":[{"type":"text","text":"Display only the discounted price prominently."}],"type":"paragraph"}]},{"isCorrect":true,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Clearly show the regular price, discounted price, and price after offer ends."}]}],"justification":[{"type":"paragraph","inlineContent":[{"type":"text","text":"HIG requires transparent price information."},{"type":"text","text":" "},{"type":"text","text":"Users must be able to clearly understand the offer terms."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Offer period doesnâ€™t need to be displayed.","type":"text"}]}],"justification":[{"inlineContent":[{"text":"Offer period and terms must be clearly stated.","type":"text"}],"type":"paragraph"}],"isCorrect":false}],"title":[{"type":"paragraph","inlineContent":[{"text":"What is the correct way to display offers according to HIG guidelines?","type":"text"}]}]}],"kind":"assessments"},{"action":{"overridingTitleInlineContent":[{"type":"text","text":"Get started"}],"type":"reference","isActive":true,"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing","overridingTitle":"Get started"},"featuredEyebrow":"Tutorial","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"type":"text","text":" "},{"type":"text","text":"Xcodeâ€™s StoreKit Testing and Sandbox environment."}],"kind":"callToAction","title":"StoreKit Testing"}],"hierarchy":{"paths":[["doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents","doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/$volume","doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-10:-Subscription-Discount-Offers"]],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents","modules":[{"projects":[{"sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit#What-is-StoreKit-2"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-1:-Understanding-StoreKit-2"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-2:-Loading-Products","projects":[{"sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products#Loading-Products","kind":"task"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products"}]},{"projects":[{"sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow#Purchase-Handling"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-3:-Purchase-Flow"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status","sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status#Checking-Subscription-Status"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-4:-Subscription-Management"},{"projects":[{"sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI#Paywall-Design","kind":"task"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-5:-Paywall-UI"},{"projects":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions","sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Groups-and-Levels","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Upgrades-Downgrades","kind":"task"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Renewal-Status"},{"kind":"assessment","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Check-Your-Understanding"}]}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-7:-Advanced-Subscription-Management"},{"projects":[{"sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Understanding-Family-Sharing","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#UI-Branching-by-Ownership-Type","kind":"task"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Handling-Family-Sharing-Cancellation"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Check-Your-Understanding","kind":"assessment"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-8:-Family-Sharing"},{"projects":[{"sections":[{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-API-Overview"},{"kind":"task","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-Notifications-V2"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#JWS-Verification","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Check-Your-Understanding","kind":"assessment"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-9:-App-Store-Server-API"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-10:-Subscription-Discount-Offers","projects":[{"sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Introductory-Offers","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Promotional-Offers","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Codes","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Strategy-HIG-Guidelines","kind":"task"},{"kind":"assessment","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Check-Your-Understanding"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers"}]},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-11:-StoreKit-Testing","projects":[{"sections":[{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#StoreKit-Configuration-File","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Writing-Unit-Tests","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Sandbox-Testing","kind":"task"},{"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Error-Scenario-Testing","kind":"task"},{"kind":"assessment","reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Check-Your-Understanding"}],"reference":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing"}]}]},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers"},"metadata":{"role":"project","category":"Building a Subscription App","title":"Subscription Discount Offers","categoryPathComponent":"Table-of-Contents"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/tutorials\/higstorekit\/10-subscription-offers"]}],"references":{"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Writing-Unit-Tests":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Writing-Unit-Tests","title":"Writing Unit Tests","kind":"section","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"type":"text","text":" "},{"type":"text","text":"Xcodeâ€™s StoreKit Testing and Sandbox environment."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#Writing-Unit-Tests","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Offer-Strategy-HIG-Guidelines":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Strategy-HIG-Guidelines","title":"Offer Strategy & HIG Guidelines","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"text":" ","type":"text"},{"text":"using Introductory Offers, Promotional Offers, and Offer Codes.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Offer-Strategy-HIG-Guidelines","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Subscription-Upgrades-Downgrades":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Upgrades-Downgrades","title":"Subscription Upgrades & Downgrades","kind":"section","abstract":[{"type":"text","text":"Implement all subscription management features needed for a real service,"},{"type":"text","text":" "},{"type":"text","text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/07-subscriptions#Subscription-Upgrades-Downgrades","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Offer-Codes":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Offer-Codes","title":"Offer Codes","kind":"section","abstract":[{"text":"Implement new user acquisition and churn prevention strategies","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"using Introductory Offers, Promotional Offers, and Offer Codes."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Offer-Codes","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-7:-Advanced-Subscription-Management":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-7:-Advanced-Subscription-Management","title":"Ring 7: Advanced Subscription Management","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-7:-advanced-subscription-management","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#Understanding-Family-Sharing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Understanding-Family-Sharing","title":"Understanding Family Sharing","kind":"section","abstract":[{"text":"Enable up to 6 family members to use the app","type":"text"},{"type":"text","text":" "},{"text":"with a single subscription through Family Sharing.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/08-familysharing#Understanding-Family-Sharing","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Subscription-Renewal-Status":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Renewal-Status","title":"Subscription Renewal Status","kind":"section","abstract":[{"text":"Implement all subscription management features needed for a real service,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/07-subscriptions#Subscription-Renewal-Status","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/01-Understanding-StoreKit#What-is-StoreKit-2":{"type":"section","kind":"section","title":"What is StoreKit 2?","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/01-understanding-storekit#What-is-StoreKit-2","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit#What-is-StoreKit-2","abstract":[{"type":"text","text":"Learn the core concepts of StoreKit 2 and HIG in-app purchase guidelines."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#JWS-Verification":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#JWS-Verification","title":"JWS Verification","kind":"section","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"text":" ","type":"text"},{"type":"text","text":"and handle real-time events with App Store Server Notifications."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/09-appstore#JWS-Verification","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/03-Purchase-Flow#Purchase-Handling":{"type":"section","kind":"section","title":"Purchase Handling","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/03-purchase-flow#Purchase-Handling","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow#Purchase-Handling","abstract":[{"type":"text","text":"Implement the complete flow for users to purchase products."}]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-11:-StoreKit-Testing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-11:-StoreKit-Testing","title":"Ring 11: StoreKit Testing","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-11:-storekit-testing","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Sandbox-Testing":{"type":"section","kind":"section","title":"Sandbox Testing","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#Sandbox-Testing","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Sandbox-Testing","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"type":"text","text":" "},{"type":"text","text":"Xcodeâ€™s StoreKit Testing and Sandbox environment."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#Handling-Family-Sharing-Cancellation":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Handling-Family-Sharing-Cancellation","title":"Handling Family Sharing Cancellation","kind":"section","abstract":[{"text":"Enable up to 6 family members to use the app","type":"text"},{"type":"text","text":" "},{"type":"text","text":"with a single subscription through Family Sharing."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/08-familysharing#Handling-Family-Sharing-Cancellation","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents","title":"Building a Subscription App with StoreKit 2","kind":"overview","abstract":[{"type":"text","text":"Implement a subscription payment system using"},{"type":"text","text":" "},{"text":"StoreKit 2â€™s modern async\/await APIs.","type":"text"}],"role":"overview","url":"\/tutorials\/table-of-contents","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-2:-Loading-Products":{"type":"topic","kind":"article","title":"Ring 2: Loading Products","role":"article","url":"\/tutorials\/table-of-contents\/ring-2:-loading-products","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-2:-Loading-Products","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/03-Purchase-Flow":{"type":"topic","kind":"project","title":"Implementing Purchase Flow","role":"project","estimatedTime":"15min","url":"\/tutorials\/higstorekit\/03-purchase-flow","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/03-Purchase-Flow","abstract":[{"type":"text","text":"Implement the complete flow for users to purchase products."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing":{"type":"topic","kind":"project","title":"StoreKit Testing","role":"project","estimatedTime":"25min","url":"\/tutorials\/higstorekit\/11-testing","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing","abstract":[{"text":"Thoroughly test in-app purchase functionality using","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Xcodeâ€™s StoreKit Testing and Sandbox environment."}]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-1:-Understanding-StoreKit-2":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-1:-Understanding-StoreKit-2","title":"Ring 1: Understanding StoreKit 2","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-1:-understanding-storekit-2","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#Server-API-Overview":{"type":"section","kind":"section","title":"Server API Overview","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/09-appstore#Server-API-Overview","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-API-Overview","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"type":"text","text":"and handle real-time events with App Store Server Notifications."}]},"10-offer-badge-view.swift":{"type":"file","fileName":"OfferBadgeView.swift","content":["import SwiftUI","import StoreKit","","\/\/\/ HIG ê°€ì´ë“œë¼ì¸ì„ ì¤€ìˆ˜í•˜ëŠ” ì˜¤í¼ ë°°ì§€ ì»´í¬ë„ŒíŠ¸","struct HIGOfferBadge: View {","    let offerType: OfferType","    let originalPrice: String","    let offerPrice: String","    let duration: String","    let afterOfferPrice: String","    ","    enum OfferType {","        case freeTrial","        case introductory","        case promotional","        case offerCode","        ","        var icon: String {","            switch self {","            case .freeTrial: return \"gift.fill\"","            case .introductory: return \"sparkles\"","            case .promotional: return \"tag.fill\"","            case .offerCode: return \"ticket.fill\"","            }","        }","        ","        var color: Color {","            switch self {","            case .freeTrial: return .green","            case .introductory: return .blue","            case .promotional: return .orange","            case .offerCode: return .purple","            }","        }","        ","        var title: String {","            switch self {","            case .freeTrial: return \"ë¬´ë£Œ ì²´í—˜\"","            case .introductory: return \"ì²« êµ¬ë… í• ì¸\"","            case .promotional: return \"íŠ¹ë³„ í• ì¸\"","            case .offerCode: return \"í”„ë¡œëª¨ì…˜ ì½”ë“œ\"","            }","        }","    }","    ","    var body: some View {","        VStack(spacing: 16) {","            \/\/ ë°°ì§€ í—¤ë”","            HStack {","                Image(systemName: offerType.icon)","                Text(offerType.title)","                    .font(.headline)","            }","            .foregroundStyle(offerType.color)","            .padding(.horizontal, 16)","            .padding(.vertical, 8)","            .background(offerType.color.opacity(0.15))","            .clipShape(Capsule())","            ","            \/\/ ê°€ê²© ë¹„êµ","            VStack(spacing: 8) {","                \/\/ í• ì¸ ê°€ê²© (ê°•ì¡°)","                HStack(alignment: .firstTextBaseline, spacing: 4) {","                    Text(offerPrice)","                        .font(.system(size: 36, weight: .bold, design: .rounded))","                    Text(\"\/ \\(duration)\")","                        .font(.subheadline)","                        .foregroundStyle(.secondary)","                }","                ","                \/\/ ì •ìƒ ê°€ê²© (ì·¨ì†Œì„ )","                Text(\"ì •ìƒê°€ \\(originalPrice)\")","                    .font(.subheadline)","                    .strikethrough()","                    .foregroundStyle(.secondary)","            }","            ","            Divider()","            ","            \/\/ HIG í•„ìˆ˜: ì˜¤í¼ ì¢…ë£Œ í›„ ê°€ê²© ì•ˆë‚´","            VStack(spacing: 4) {","                Text(\"ì²´í—˜ ì¢…ë£Œ í›„\")","                    .font(.caption)","                    .foregroundStyle(.secondary)","                Text(\"\\(afterOfferPrice)\/ì›” ìë™ ê°±ì‹ \")","                    .font(.footnote.bold())","            }","            .padding(.horizontal)","            .padding(.vertical, 8)","            .frame(maxWidth: .infinity)","            .background(Color(.systemGray6))","            .clipShape(RoundedRectangle(cornerRadius: 8))","        }","        .padding()","        .background(.background)","        .clipShape(RoundedRectangle(cornerRadius: 20))","        .shadow(color: .black.opacity(0.1), radius: 10, y: 5)","    }","}","","\/\/ MARK: - ì˜¤í¼ ì¹´ë“œ (í˜ì´ì›”ìš©)","","struct OfferCard: View {","    let product: Product","    let offer: Product.SubscriptionOffer?","    let isEligible: Bool","    let isSelected: Bool","    let onSelect: () -> Void","    ","    var body: some View {","        Button(action: onSelect) {","            VStack(spacing: 12) {","                \/\/ ìƒë‹¨: ì˜¤í¼ ë°°ì§€","                if isEligible, let offer = offer {","                    HStack {","                        Spacer()","                        OfferTypeBadge(paymentMode: offer.paymentMode)","                    }","                }","                ","                \/\/ ìƒí’ˆëª…","                Text(product.displayName)","                    .font(.headline)","                ","                \/\/ ê°€ê²© ì •ë³´","                if isEligible, let offer = offer {","                    \/\/ ì˜¤í¼ ê°€ê²©","                    Text(offer.displayPrice)","                        .font(.title.bold())","                    ","                    Text(\"ì´í›„ \\(product.displayPrice)\/ì›”\")","                        .font(.caption)","                        .foregroundStyle(.secondary)","                } else {","                    \/\/ ì •ìƒ ê°€ê²©","                    Text(product.displayPrice)","                        .font(.title.bold())","                    ","                    Text(\"\/ ì›”\")","                        .font(.caption)","                        .foregroundStyle(.secondary)","                }","            }","            .frame(maxWidth: .infinity)","            .padding()","            .background(isSelected ? Color.accentColor.opacity(0.1) : Color(.systemGray6))","            .clipShape(RoundedRectangle(cornerRadius: 16))","            .overlay(","                RoundedRectangle(cornerRadius: 16)","                    .stroke(isSelected ? Color.accentColor : .clear, lineWidth: 2)","            )","        }","        .buttonStyle(.plain)","    }","}","","struct OfferTypeBadge: View {","    let paymentMode: Product.SubscriptionOffer.PaymentMode","    ","    var body: some View {","        Text(badgeText)","            .font(.caption2.bold())","            .padding(.horizontal, 8)","            .padding(.vertical, 4)","            .background(badgeColor)","            .foregroundStyle(.white)","            .clipShape(Capsule())","    }","    ","    private var badgeText: String {","        switch paymentMode {","        case .freeTrial: return \"ë¬´ë£Œ ì²´í—˜\"","        case .payAsYouGo: return \"í• ì¸\"","        case .payUpFront: return \"ì„ ë¶ˆ í• ì¸\"","        @unknown default: return \"íŠ¹ë³„ ì˜¤í¼\"","        }","    }","    ","    private var badgeColor: Color {","        switch paymentMode {","        case .freeTrial: return .green","        case .payAsYouGo: return .orange","        case .payUpFront: return .blue","        @unknown default: return .purple","        }","    }","}","","\/\/ MARK: - Previews","","#Preview(\"HIG ì˜¤í¼ ë°°ì§€\") {","    VStack(spacing: 20) {","        HIGOfferBadge(","            offerType: .freeTrial,","            originalPrice: \"â‚©11,000\",","            offerPrice: \"â‚©0\",","            duration: \"7ì¼\",","            afterOfferPrice: \"â‚©11,000\"","        )","        ","        HIGOfferBadge(","            offerType: .promotional,","            originalPrice: \"â‚©11,000\",","            offerPrice: \"â‚©5,500\",","            duration: \"ì²« ë‹¬\",","            afterOfferPrice: \"â‚©11,000\"","        )","    }","    .padding()","    .background(Color(.systemGray5))","}"],"fileType":"swift","identifier":"10-offer-badge-view.swift","syntax":"swift","highlights":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/05-Paywall-UI":{"type":"topic","kind":"project","title":"HIG-Compliant Paywall UI","role":"project","estimatedTime":"20min","url":"\/tutorials\/higstorekit\/05-paywall-ui","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI","abstract":[{"type":"text","text":"Design a paywall screen that follows Apple HIG guidelines."}]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-5:-Paywall-UI":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-5:-Paywall-UI","title":"Ring 5: Paywall UI","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-5:-paywall-ui","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-4:-Subscription-Management":{"type":"topic","kind":"article","title":"Ring 4: Subscription Management","role":"article","url":"\/tutorials\/table-of-contents\/ring-4:-subscription-management","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-4:-Subscription-Management","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/02-Loading-Products":{"type":"topic","kind":"project","title":"Loading Products","role":"project","estimatedTime":"15min","url":"\/tutorials\/higstorekit\/02-loading-products","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products","abstract":[{"text":"Load product information configured in App Store Connect.","type":"text"}]},"10-intro-offer-view.swift":{"fileName":"IntroOfferView.swift","fileType":"swift","identifier":"10-intro-offer-view.swift","content":["import SwiftUI","import StoreKit","","\/\/\/ Introductory Offerë¥¼ í‘œì‹œí•˜ëŠ” í˜ì´ì›” ë·°","struct IntroOfferView: View {","    let product: Product","    let isEligible: Bool","    let onPurchase: () async -> Void","    ","    var body: some View {","        VStack(spacing: 16) {","            \/\/ ìƒí’ˆ ì •ë³´","            Text(product.displayName)","                .font(.title2.bold())","            ","            Text(product.description)","                .font(.subheadline)","                .foregroundStyle(.secondary)","            ","            \/\/ ì˜¤í¼ ë°°ì§€","            if isEligible, let intro = product.subscription?.introductoryOffer {","                IntroOfferBadge(offer: intro)","            }","            ","            \/\/ ê°€ê²© ì •ë³´","            PriceSection(product: product, isEligible: isEligible)","            ","            \/\/ êµ¬ë… ë²„íŠ¼","            Button {","                Task { await onPurchase() }","            } label: {","                Text(buttonTitle)","                    .font(.headline)","                    .frame(maxWidth: .infinity)","                    .padding()","                    .background(Color.accentColor)","                    .foregroundStyle(.white)","                    .clipShape(RoundedRectangle(cornerRadius: 12))","            }","            ","            \/\/ HIG: ì˜¤í¼ ì¢…ë£Œ í›„ ê°€ê²© ì•ˆë‚´","            if isEligible {","                Text(\"ì²´í—˜ ì¢…ë£Œ í›„ \\(product.displayPrice)\/ì›”ì´ ì²­êµ¬ë©ë‹ˆë‹¤\")","                    .font(.caption)","                    .foregroundStyle(.secondary)","            }","        }","        .padding()","    }","    ","    private var buttonTitle: String {","        if isEligible, let intro = product.subscription?.introductoryOffer {","            switch intro.paymentMode {","            case .freeTrial:","                return \"ë¬´ë£Œ ì²´í—˜ ì‹œì‘í•˜ê¸°\"","            case .payAsYouGo, .payUpFront:","                return \"\\(intro.displayPrice)ì— ì‹œì‘í•˜ê¸°\"","            @unknown default:","                return \"êµ¬ë…í•˜ê¸°\"","            }","        }","        return \"\\(product.displayPrice)ì— êµ¬ë…í•˜ê¸°\"","    }","}","","struct IntroOfferBadge: View {","    let offer: Product.SubscriptionOffer","    ","    var body: some View {","        HStack {","            Image(systemName: iconName)","            Text(badgeText)","                .font(.subheadline.bold())","        }","        .padding(.horizontal, 12)","        .padding(.vertical, 8)","        .background(Color.green.opacity(0.15))","        .foregroundStyle(.green)","        .clipShape(Capsule())","    }","    ","    private var iconName: String {","        switch offer.paymentMode {","        case .freeTrial: return \"gift\"","        case .payAsYouGo: return \"tag\"","        case .payUpFront: return \"creditcard\"","        @unknown default: return \"star\"","        }","    }","    ","    private var badgeText: String {","        switch offer.paymentMode {","        case .freeTrial:","            return \"\\(offer.period.value)ì¼ ë¬´ë£Œ ì²´í—˜\"","        case .payAsYouGo:","            return \"\\(offer.periodCount)íšŒ \\(offer.displayPrice)\"","        case .payUpFront:","            return \"\\(offer.displayPrice) ì„ ë¶ˆ í• ì¸\"","        @unknown default:","            return \"íŠ¹ë³„ ì˜¤í¼\"","        }","    }","}","","struct PriceSection: View {","    let product: Product","    let isEligible: Bool","    ","    var body: some View {","        VStack(spacing: 4) {","            if isEligible, let intro = product.subscription?.introductoryOffer {","                \/\/ í• ì¸ ê°€ê²© ê°•ì¡°","                HStack(alignment: .firstTextBaseline, spacing: 4) {","                    Text(intro.displayPrice)","                        .font(.largeTitle.bold())","                    if intro.paymentMode != .freeTrial {","                        Text(\"\/ \\(intro.period.unit.localizedDescription)\")","                            .foregroundStyle(.secondary)","                    }","                }","                ","                \/\/ ì •ìƒ ê°€ê²© ì·¨ì†Œì„ ","                Text(\"ì •ìƒê°€ \\(product.displayPrice)\")","                    .font(.subheadline)","                    .strikethrough()","                    .foregroundStyle(.secondary)","            } else {","                \/\/ ì •ìƒ ê°€ê²© í‘œì‹œ","                HStack(alignment: .firstTextBaseline, spacing: 4) {","                    Text(product.displayPrice)","                        .font(.largeTitle.bold())","                    Text(\"\/ ì›”\")","                        .foregroundStyle(.secondary)","                }","            }","        }","    }","}"],"syntax":"swift","highlights":[],"type":"file"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#Check-Your-Understanding":{"title":"Check Your Understanding","url":"\/tutorials\/higstorekit\/08-familysharing#Check-Your-Understanding","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#Check-Your-Understanding","titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"type":"link"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#Check-Your-Understanding":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Check-Your-Understanding","title":"Check Your Understanding","type":"link","titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"url":"\/tutorials\/higstorekit\/09-appstore#Check-Your-Understanding"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore","title":"App Store Server API","kind":"project","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"text":"and handle real-time events with App Store Server Notifications.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/09-appstore","estimatedTime":"30min","type":"topic"},"10-offer-code-redemption.swift":{"fileName":"OfferCodeRedemption.swift","fileType":"swift","identifier":"10-offer-code-redemption.swift","content":["import SwiftUI","import StoreKit","","\/\/\/ ì˜¤í¼ ì½”ë“œ ì‹œíŠ¸ í‘œì‹œ (iOS 16+)","struct OfferCodeRedemptionDemo: View {","    @State private var showingRedeemSheet = false","    @State private var redemptionMessage: String?","    ","    var body: some View {","        VStack(spacing: 20) {","            Text(\"í”„ë¦¬ë¯¸ì—„ êµ¬ë…\")","                .font(.largeTitle.bold())","            ","            \/\/ ì˜¤í¼ ì½”ë“œ ë²„íŠ¼","            Button {","                showingRedeemSheet = true","            } label: {","                HStack {","                    Image(systemName: \"ticket\")","                    Text(\"ì˜¤í¼ ì½”ë“œ ì‚¬ìš©\")","                }","                .font(.headline)","                .padding()","                .frame(maxWidth: .infinity)","                .background(Color(.systemGray5))","                .clipShape(RoundedRectangle(cornerRadius: 12))","            }","            ","            if let message = redemptionMessage {","                Text(message)","                    .foregroundStyle(message.contains(\"ì„±ê³µ\") ? .green : .red)","            }","        }","        .padding()","        \/\/ iOS 16+: offerCodeRedemption modifier","        .offerCodeRedemption(isPresented: $showingRedeemSheet) { result in","            switch result {","            case .success:","                redemptionMessage = \"âœ… ì½”ë“œ ì ìš© ì„±ê³µ!\"","                \/\/ êµ¬ë… ìƒíƒœ ìƒˆë¡œê³ ì¹¨","                Task {","                    await refreshSubscriptionStatus()","                }","            case .failure(let error):","                if case StoreKitError.userCancelled = error {","                    redemptionMessage = nil","                } else {","                    redemptionMessage = \"âŒ ì˜¤ë¥˜: \\(error.localizedDescription)\"","                }","            }","        }","    }","    ","    private func refreshSubscriptionStatus() async {","        \/\/ Transaction.currentEntitlementsë¡œ êµ¬ë… ìƒíƒœ ê°±ì‹ ","        for await result in Transaction.currentEntitlements {","            if case .verified(let transaction) = result {","                print(\"ğŸ“¦ í™œì„± ê¶Œí•œ: \\(transaction.productID)\")","            }","        }","    }","}","","\/\/ MARK: - í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì½”ë“œ ì…ë ¥ (iOS 14+)","","\/\/\/ AppStoreì—ì„œ ì§ì ‘ ì½”ë“œ ì…ë ¥ í™”ë©´ ì—´ê¸°","struct LegacyOfferCodeRedemption {","    \/\/\/ App Store ì½”ë“œ ì…ë ¥ URL ì—´ê¸°","    \/\/\/ iOS 14-15ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë°©ì‹","    static func openAppStoreRedemption() {","        if let url = URL(string: \"https:\/\/apps.apple.com\/redeem\") {","            UIApplication.shared.open(url)","        }","    }","}","","\/\/ MARK: - ì˜¤í¼ ì½”ë“œ ê´€ë ¨ ë”¥ë§í¬ ì²˜ë¦¬","","\/\/\/ ì™¸ë¶€ì—ì„œ ì˜¤í¼ ì½”ë“œë¡œ ì•± ì—´ê¸° ì²˜ë¦¬","\/\/\/ URL í˜•ì‹: yourapp:\/\/redeem?code=ABCD-1234-EFGH","class OfferCodeDeepLinkHandler {","    ","    func handle(url: URL) -> Bool {","        guard url.scheme == \"yourapp\",","              url.host == \"redeem\",","              let components = URLComponents(url: url, resolvingAgainstBaseURL: false),","              let code = components.queryItems?.first(where: { $0.name == \"code\" })?.value","        else {","            return false","        }","        ","        \/\/ ì½”ë“œì™€ í•¨ê»˜ ì˜¤í¼ ì½”ë“œ ì‹œíŠ¸ í‘œì‹œ","        \/\/ ì°¸ê³ : presentOfferCodeRedeemSheetëŠ” ì½”ë“œ ìë™ ì…ë ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ","        \/\/ ì‚¬ìš©ìê°€ ì§ì ‘ ì½”ë“œë¥¼ ì…ë ¥í•´ì•¼ í•¨","        NotificationCenter.default.post(","            name: .showOfferCodeSheet,","            object: nil,","            userInfo: [\"code\": code]","        )","        ","        return true","    }","}","","extension Notification.Name {","    static let showOfferCodeSheet = Notification.Name(\"showOfferCodeSheet\")","}","","\/\/ MARK: - ë©”ì¸ ì•±ì—ì„œ ë”¥ë§í¬ ì²˜ë¦¬ ì˜ˆì‹œ","","struct OfferCodeApp: App {","    @State private var showingOfferCode = false","    ","    var body: some Scene {","        WindowGroup {","            ContentView()","                .offerCodeRedemption(isPresented: $showingOfferCode) { _ in }","                .onOpenURL { url in","                    if url.host == \"redeem\" {","                        showingOfferCode = true","                    }","                }","                .onReceive(NotificationCenter.default.publisher(for: .showOfferCodeSheet)) { _ in","                    showingOfferCode = true","                }","        }","    }","}","","struct ContentView: View {","    var body: some View {","        Text(\"Premium App\")","    }","}","","#Preview {","    OfferCodeRedemptionDemo()","}"],"syntax":"swift","highlights":[],"type":"file"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/04-Subscription-Status":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status","title":"Managing Subscription Status","kind":"project","abstract":[{"type":"text","text":"Check subscription status and handle renewals."}],"role":"project","url":"\/tutorials\/higstorekit\/04-subscription-status","estimatedTime":"15min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/04-Subscription-Status#Checking-Subscription-Status":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/04-Subscription-Status#Checking-Subscription-Status","title":"Checking Subscription Status","kind":"section","abstract":[{"text":"Check subscription status and handle renewals.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/04-subscription-status#Checking-Subscription-Status","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers","title":"Subscription Discount Offers","kind":"project","abstract":[{"text":"Implement new user acquisition and churn prevention strategies","type":"text"},{"type":"text","text":" "},{"text":"using Introductory Offers, Promotional Offers, and Offer Codes.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/10-subscription-offers","estimatedTime":"30min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Introductory-Offers":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Introductory-Offers","title":"Introductory Offers","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"text":" ","type":"text"},{"type":"text","text":"using Introductory Offers, Promotional Offers, and Offer Codes."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Introductory-Offers","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Subscription-Groups-and-Levels":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Subscription-Groups-and-Levels","title":"Subscription Groups and Levels","kind":"section","abstract":[{"type":"text","text":"Implement all subscription management features needed for a real service,"},{"text":" ","type":"text"},{"text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/07-subscriptions#Subscription-Groups-and-Levels","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-8:-Family-Sharing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-8:-Family-Sharing","title":"Ring 8: Family Sharing","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-8:-family-sharing","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Check-Your-Understanding":{"titleInlineContent":[{"text":"Check Your Understanding","type":"text"}],"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Check-Your-Understanding","type":"link","title":"Check Your Understanding","url":"\/tutorials\/higstorekit\/11-testing#Check-Your-Understanding"},"10-intro-offer-manager.swift":{"fileName":"IntroOfferManager.swift","fileType":"swift","identifier":"10-intro-offer-manager.swift","content":["import StoreKit","","\/\/\/ Introductory Offer ìê²© í™•ì¸ ë° ê´€ë¦¬","@MainActor","class IntroOfferManager: ObservableObject {","    @Published var eligibleProducts: [Product] = []","    @Published var isLoading = false","    ","    \/\/\/ êµ¬ë… ê·¸ë£¹ë³„ Introductory Offer ìê²© í™•ì¸","    func checkEligibility(for products: [Product]) async {","        isLoading = true","        defer { isLoading = false }","        ","        var eligible: [Product] = []","        ","        for product in products {","            \/\/ ìë™ ê°±ì‹  êµ¬ë… ìƒí’ˆë§Œ ì²´í¬","            guard product.type == .autoRenewable else { continue }","            ","            \/\/ Introductory Offer ì¡´ì¬ ì—¬ë¶€ í™•ì¸","            guard let introOffer = product.subscription?.introductoryOffer else {","                continue","            }","            ","            \/\/ ìê²© í™•ì¸ (êµ¬ë… ê·¸ë£¹ë‹¹ í•œ ë²ˆë§Œ ê°€ëŠ¥)","            let isEligible = await product.subscription?.isEligibleForIntroOffer ?? false","            ","            if isEligible {","                eligible.append(product)","                print(\"âœ… \\(product.displayName): ì†Œê°œ ì˜¤í¼ ìê²© ìˆìŒ\")","                print(\"   - ìœ í˜•: \\(introOffer.paymentMode.description)\")","                print(\"   - ê¸°ê°„: \\(introOffer.period.debugDescription)\")","            } else {","                print(\"âŒ \\(product.displayName): ì†Œê°œ ì˜¤í¼ ìê²© ì—†ìŒ\")","            }","        }","        ","        eligibleProducts = eligible","    }","    ","    \/\/\/ Introductory Offer ìƒì„¸ ì •ë³´ í¬ë§·íŒ…","    func formatIntroOffer(for product: Product) -> IntroOfferInfo? {","        guard let intro = product.subscription?.introductoryOffer else {","            return nil","        }","        ","        let description: String","        switch intro.paymentMode {","        case .freeTrial:","            description = \"\\(intro.period.value)ì¼ ë¬´ë£Œ ì²´í—˜\"","        case .payAsYouGo:","            description = \"\\(intro.displayPrice)ë¡œ \\(intro.periodCount)íšŒ\"","        case .payUpFront:","            description = \"\\(intro.displayPrice) ì„ ë¶ˆ\"","        @unknown default:","            description = \"íŠ¹ë³„ ì˜¤í¼\"","        }","        ","        return IntroOfferInfo(","            type: intro.paymentMode,","            description: description,","            originalPrice: product.displayPrice,","            offerPrice: intro.displayPrice,","            duration: intro.period","        )","    }","}","","struct IntroOfferInfo {","    let type: Product.SubscriptionOffer.PaymentMode","    let description: String","    let originalPrice: String","    let offerPrice: String","    let duration: Product.SubscriptionPeriod","}","","extension Product.SubscriptionOffer.PaymentMode {","    var description: String {","        switch self {","        case .freeTrial: return \"ë¬´ë£Œ ì²´í—˜\"","        case .payAsYouGo: return \"í• ì¸ ê²°ì œ\"","        case .payUpFront: return \"ì„ ë¶ˆ í• ì¸\"","        @unknown default: return \"íŠ¹ë³„ ì˜¤í¼\"","        }","    }","}"],"syntax":"swift","highlights":[],"type":"file"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/01-Understanding-StoreKit":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/01-Understanding-StoreKit","title":"Understanding StoreKit 2","kind":"project","abstract":[{"text":"Learn the core concepts of StoreKit 2 and HIG in-app purchase guidelines.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/01-understanding-storekit","estimatedTime":"10min","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Promotional-Offers":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Promotional-Offers","title":"Promotional Offers","kind":"section","abstract":[{"type":"text","text":"Implement new user acquisition and churn prevention strategies"},{"type":"text","text":" "},{"type":"text","text":"using Introductory Offers, Promotional Offers, and Offer Codes."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/10-subscription-offers#Promotional-Offers","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/10-Subscription-Offers#Check-Your-Understanding":{"type":"link","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/10-Subscription-Offers#Check-Your-Understanding","url":"\/tutorials\/higstorekit\/10-subscription-offers#Check-Your-Understanding","title":"Check Your Understanding","titleInlineContent":[{"type":"text","text":"Check Your Understanding"}]},"10-offer-signer.swift":{"fileName":"OfferSigner.swift","fileType":"swift","identifier":"10-offer-signer.swift","content":["import Foundation","import CryptoKit","","\/\/\/ ì„œë²„ ì‚¬ì´ë“œ: Promotional Offer ì„œëª… ìƒì„±","\/\/\/ âš ï¸ ì´ ì½”ë“œëŠ” ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.","\/\/\/ í´ë¼ì´ì–¸íŠ¸ì—ì„œ Private Keyë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤!","struct OfferSigner {","    ","    \/\/\/ App Store Connectì—ì„œ ìƒì„±í•œ Subscription Key","    private let keyId: String","    ","    \/\/\/ Private Key (PEM í˜•ì‹)","    private let privateKey: P256.Signing.PrivateKey","    ","    \/\/\/ Bundle ID","    private let bundleId: String","    ","    init(keyId: String, privateKeyPEM: String, bundleId: String) throws {","        self.keyId = keyId","        self.bundleId = bundleId","        self.privateKey = try P256.Signing.PrivateKey(pemRepresentation: privateKeyPEM)","    }","    ","    \/\/\/ Promotional Offer ì„œëª… ìƒì„±","    func generateSignature(","        productId: String,","        offerId: String,","        applicationUsername: String","    ) throws -> OfferSignature {","        \/\/ ê³ ìœ  nonce ìƒì„±","        let nonce = UUID()","        ","        \/\/ í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„ (ë°€ë¦¬ì´ˆ)","        let timestamp = Int(Date().timeIntervalSince1970 * 1000)","        ","        \/\/ ì„œëª…í•  í˜ì´ë¡œë“œ êµ¬ì„±","        \/\/ í˜•ì‹: appBundleID + keyIdentifier + productIdentifier + offerIdentifier + applicationUsername + nonce + timestamp","        let payload = [","            bundleId,","            keyId,","            productId,","            offerId,","            applicationUsername,","            nonce.uuidString,","            String(timestamp)","        ].joined(separator: \"\\u{2063}\")  \/\/ Invisible separator","        ","        \/\/ ECDSA P-256 ì„œëª…","        let payloadData = Data(payload.utf8)","        let signature = try privateKey.signature(for: payloadData)","        let signatureBase64 = signature.derRepresentation.base64EncodedString()","        ","        return OfferSignature(","            keyId: keyId,","            nonce: nonce,","            timestamp: timestamp,","            signature: signatureBase64","        )","    }","}","","\/\/\/ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•  ì„œëª… ì •ë³´","struct OfferSignature: Codable {","    let keyId: String","    let nonce: UUID","    let timestamp: Int","    let signature: String","}","","\/\/ MARK: - API ì—”ë“œí¬ì¸íŠ¸ ì˜ˆì‹œ (Server-side)","","\/*"," ì„œë²„ API ì˜ˆì‹œ (Node.js\/Swift Vapor\/etc.):"," "," POST \/api\/promotional-offer\/sign"," "," Request:"," {","   \"productId\": \"com.app.premium.monthly\",","   \"offerId\": \"winback_50_off\",","   \"userId\": \"user123\""," }"," "," Response:"," {","   \"keyId\": \"ABC123DEFG\",","   \"nonce\": \"550e8400-e29b-41d4-a716-446655440000\",","   \"timestamp\": 1640000000000,","   \"signature\": \"MEUCIQDr3...\""," }","*\/","","\/\/ MARK: - í´ë¼ì´ì–¸íŠ¸ API í˜¸ì¶œ","","\/\/\/ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ API í˜¸ì¶œí•˜ì—¬ ì„œëª… íšë“","class OfferSignatureService {","    let baseURL: URL","    ","    init(baseURL: URL) {","        self.baseURL = baseURL","    }","    ","    func requestSignature(","        productId: String,","        offerId: String,","        userId: String","    ) async throws -> OfferSignature {","        let url = baseURL.appendingPathComponent(\"promotional-offer\/sign\")","        ","        var request = URLRequest(url: url)","        request.httpMethod = \"POST\"","        request.setValue(\"application\/json\", forHTTPHeaderField: \"Content-Type\")","        ","        let body: [String: String] = [","            \"productId\": productId,","            \"offerId\": offerId,","            \"userId\": userId","        ]","        request.httpBody = try JSONEncoder().encode(body)","        ","        let (data, response) = try await URLSession.shared.data(for: request)","        ","        guard let httpResponse = response as? HTTPURLResponse,","              httpResponse.statusCode == 200 else {","            throw SignatureError.serverError","        }","        ","        return try JSONDecoder().decode(OfferSignature.self, from: data)","    }","}","","enum SignatureError: Error {","    case serverError","    case invalidSignature","}"],"syntax":"swift","highlights":[],"type":"file"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#Error-Scenario-Testing":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#Error-Scenario-Testing","title":"Error Scenario Testing","kind":"section","abstract":[{"text":"Thoroughly test in-app purchase functionality using","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Xcodeâ€™s StoreKit Testing and Sandbox environment."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#Error-Scenario-Testing","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing#UI-Branching-by-Ownership-Type":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing#UI-Branching-by-Ownership-Type","title":"UI Branching by Ownership Type","kind":"section","abstract":[{"text":"Enable up to 6 family members to use the app","type":"text"},{"type":"text","text":" "},{"type":"text","text":"with a single subscription through Family Sharing."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/08-familysharing#UI-Branching-by-Ownership-Type","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/09-AppStore#Server-Notifications-V2":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/09-AppStore#Server-Notifications-V2","title":"Server Notifications V2","kind":"section","abstract":[{"type":"text","text":"Validate subscription status from the server side"},{"type":"text","text":" "},{"text":"and handle real-time events with App Store Server Notifications.","type":"text"}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/09-appstore#Server-Notifications-V2","type":"section"},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-3:-Purchase-Flow":{"type":"topic","kind":"article","title":"Ring 3: Purchase Flow","role":"article","url":"\/tutorials\/table-of-contents\/ring-3:-purchase-flow","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-3:-Purchase-Flow","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-10:-Subscription-Discount-Offers":{"type":"topic","kind":"article","title":"Ring 10: Subscription Discount Offers","role":"article","url":"\/tutorials\/table-of-contents\/ring-10:-subscription-discount-offers","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-10:-Subscription-Discount-Offers","abstract":[]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/02-Loading-Products#Loading-Products":{"type":"section","kind":"section","title":"Loading Products","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/02-loading-products#Loading-Products","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/02-Loading-Products#Loading-Products","abstract":[{"type":"text","text":"Load product information configured in App Store Connect."}]},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/08-FamilySharing":{"type":"topic","kind":"project","title":"Supporting Family Sharing","role":"project","estimatedTime":"20min","url":"\/tutorials\/higstorekit\/08-familysharing","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/08-FamilySharing","abstract":[{"type":"text","text":"Enable up to 6 family members to use the app"},{"type":"text","text":" "},{"type":"text","text":"with a single subscription through Family Sharing."}]},"doc://storekit.HIGStoreKit/tutorials/Table-of-Contents/Ring-9:-App-Store-Server-API":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/Table-of-Contents\/Ring-9:-App-Store-Server-API","title":"Ring 9: App Store Server API","kind":"article","abstract":[],"role":"article","url":"\/tutorials\/table-of-contents\/ring-9:-app-store-server-api","type":"topic"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/11-Testing#StoreKit-Configuration-File":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/11-Testing#StoreKit-Configuration-File","title":"StoreKit Configuration File","kind":"section","abstract":[{"type":"text","text":"Thoroughly test in-app purchase functionality using"},{"text":" ","type":"text"},{"type":"text","text":"Xcodeâ€™s StoreKit Testing and Sandbox environment."}],"role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/11-testing#StoreKit-Configuration-File","type":"section"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/05-Paywall-UI#Paywall-Design":{"type":"section","kind":"section","title":"Paywall Design","role":"pseudoSymbol","url":"\/tutorials\/higstorekit\/05-paywall-ui#Paywall-Design","identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/05-Paywall-UI#Paywall-Design","abstract":[{"type":"text","text":"Design a paywall screen that follows Apple HIG guidelines."}]},"10-promo-purchase.swift":{"fileName":"PromoOfferPurchase.swift","fileType":"swift","identifier":"10-promo-purchase.swift","content":["import StoreKit","import SwiftUI","","\/\/\/ Promotional Offerë¡œ êµ¬ë§¤ ì§„í–‰","@MainActor","class PromoPurchaseManager: ObservableObject {","    @Published var purchaseState: PurchaseState = .ready","    ","    private let signatureService: OfferSignatureService","    private let userId: String","    ","    init(signatureService: OfferSignatureService, userId: String) {","        self.signatureService = signatureService","        self.userId = userId","    }","    ","    \/\/\/ Promotional Offer êµ¬ë§¤ ì‹¤í–‰","    func purchaseWithPromoOffer(","        product: Product,","        offerId: String","    ) async throws -> Transaction? {","        purchaseState = .purchasing","        ","        do {","            \/\/ 1. ì„œë²„ì—ì„œ ì„œëª… íšë“","            let signature = try await signatureService.requestSignature(","                productId: product.id,","                offerId: offerId,","                userId: userId","            )","            ","            \/\/ 2. PurchaseOption êµ¬ì„±","            let options: Set<Product.PurchaseOption> = [","                .promotionalOffer(","                    offerID: offerId,","                    keyID: signature.keyId,","                    nonce: signature.nonce,","                    signature: Data(base64Encoded: signature.signature)!,","                    timestamp: signature.timestamp","                ),","                .appAccountToken(UUID(uuidString: userId) ?? UUID())","            ]","            ","            \/\/ 3. êµ¬ë§¤ ìš”ì²­","            let result = try await product.purchase(options: options)","            ","            switch result {","            case .success(let verification):","                \/\/ ì˜ìˆ˜ì¦ ê²€ì¦","                switch verification {","                case .verified(let transaction):","                    \/\/ êµ¬ë§¤ ì™„ë£Œ ì²˜ë¦¬","                    await transaction.finish()","                    purchaseState = .purchased","                    print(\"âœ… í”„ë¡œëª¨ì…˜ êµ¬ë§¤ ì™„ë£Œ: \\(product.displayName)\")","                    return transaction","                    ","                case .unverified(let transaction, let error):","                    print(\"âš ï¸ ê²€ì¦ ì‹¤íŒ¨: \\(error)\")","                    purchaseState = .failed(error)","                    return nil","                }","                ","            case .pending:","                purchaseState = .pending","                print(\"â³ êµ¬ë§¤ ëŒ€ê¸° ì¤‘ (Ask to Buy ë“±)\")","                return nil","                ","            case .userCancelled:","                purchaseState = .ready","                print(\"ğŸš« ì‚¬ìš©ì ì·¨ì†Œ\")","                return nil","                ","            @unknown default:","                purchaseState = .ready","                return nil","            }","            ","        } catch {","            purchaseState = .failed(error)","            print(\"âŒ êµ¬ë§¤ ì‹¤íŒ¨: \\(error)\")","            throw error","        }","    }","}","","enum PurchaseState: Equatable {","    case ready","    case purchasing","    case pending","    case purchased","    case failed(Error)","    ","    static func == (lhs: PurchaseState, rhs: PurchaseState) -> Bool {","        switch (lhs, rhs) {","        case (.ready, .ready), (.purchasing, .purchasing),","             (.pending, .pending), (.purchased, .purchased):","            return true","        case (.failed, .failed):","            return true","        default:","            return false","        }","    }","}","","\/\/ MARK: - Promotional Offer êµ¬ë§¤ UI","","struct PromoOfferPurchaseView: View {","    let product: Product","    let offer: PromoOfferInfo","    @ObservedObject var purchaseManager: PromoPurchaseManager","    ","    var body: some View {","        VStack(spacing: 20) {","            \/\/ ì˜¤í¼ ì •ë³´","            VStack(spacing: 8) {","                Text(\"ğŸ‰ íŠ¹ë³„ í• ì¸ ì˜¤í¼\")","                    .font(.headline)","                ","                Text(offer.description)","                    .font(.title.bold())","                    .foregroundStyle(.green)","                ","                Text(\"ì •ìƒê°€ \\(product.displayPrice)\")","                    .font(.subheadline)","                    .strikethrough()","                    .foregroundStyle(.secondary)","            }","            .padding()","            .background(Color.green.opacity(0.1))","            .clipShape(RoundedRectangle(cornerRadius: 16))","            ","            \/\/ êµ¬ë§¤ ë²„íŠ¼","            Button {","                Task {","                    try await purchaseManager.purchaseWithPromoOffer(","                        product: product,","                        offerId: offer.id","                    )","                }","            } label: {","                HStack {","                    if purchaseManager.purchaseState == .purchasing {","                        ProgressView()","                            .tint(.white)","                    }","                    Text(buttonTitle)","                }","                .font(.headline)","                .frame(maxWidth: .infinity)","                .padding()","                .background(buttonBackground)","                .foregroundStyle(.white)","                .clipShape(RoundedRectangle(cornerRadius: 12))","            }","            .disabled(purchaseManager.purchaseState == .purchasing)","            ","            \/\/ ìƒíƒœ ë©”ì‹œì§€","            statusMessage","        }","        .padding()","    }","    ","    private var buttonTitle: String {","        switch purchaseManager.purchaseState {","        case .purchasing: return \"ì²˜ë¦¬ ì¤‘...\"","        case .purchased: return \"êµ¬ë§¤ ì™„ë£Œ!\"","        default: return \"\\(offer.displayPrice)ì— êµ¬ë…í•˜ê¸°\"","        }","    }","    ","    private var buttonBackground: Color {","        switch purchaseManager.purchaseState {","        case .purchased: return .green","        case .failed: return .red","        default: return .accentColor","        }","    }","    ","    @ViewBuilder","    private var statusMessage: some View {","        switch purchaseManager.purchaseState {","        case .pending:","            Label(\"ìŠ¹ì¸ ëŒ€ê¸° ì¤‘\", systemImage: \"clock\")","                .foregroundStyle(.orange)","        case .failed(let error):","            Label(error.localizedDescription, systemImage: \"xmark.circle\")","                .foregroundStyle(.red)","        default:","            EmptyView()","        }","    }","}"],"syntax":"swift","highlights":[],"type":"file"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions":{"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions","title":"Advanced Subscription Management","kind":"project","abstract":[{"type":"text","text":"Implement all subscription management features needed for a real service,"},{"type":"text","text":" "},{"text":"including subscription renewal, upgrades\/downgrades, cancellation, and restoration.","type":"text"}],"role":"project","url":"\/tutorials\/higstorekit\/07-subscriptions","estimatedTime":"25min","type":"topic"},"10-promo-offer-manager.swift":{"fileName":"PromoOfferManager.swift","fileType":"swift","identifier":"10-promo-offer-manager.swift","content":["import StoreKit","","\/\/\/ Promotional Offer ê´€ë¦¬","@MainActor","class PromoOfferManager: ObservableObject {","    @Published var availableOffers: [PromoOfferInfo] = []","    @Published var isLoading = false","    ","    \/\/\/ ìƒí’ˆì˜ Promotional Offer ëª©ë¡ ë¡œë”©","    func loadPromotionalOffers(for product: Product) async {","        isLoading = true","        defer { isLoading = false }","        ","        guard product.type == .autoRenewable,","              let subscription = product.subscription else {","            return","        }","        ","        \/\/ í”„ë¡œëª¨ì…˜ ì˜¤í¼ ëª©ë¡ í™•ì¸","        let offers = subscription.promotionalOffers","        ","        availableOffers = offers.map { offer in","            PromoOfferInfo(","                id: offer.id,","                type: offer.type,","                displayPrice: offer.displayPrice,","                period: offer.period,","                periodCount: offer.periodCount,","                paymentMode: offer.paymentMode","            )","        }","        ","        for offer in offers {","            print(\"ğŸ“¦ í”„ë¡œëª¨ì…˜ ì˜¤í¼: \\(offer.id)\")","            print(\"   - ìœ í˜•: \\(offer.type)\")","            print(\"   - ê°€ê²©: \\(offer.displayPrice)\")","            print(\"   - ê¸°ê°„: \\(offer.period.value) \\(offer.period.unit)\")","        }","    }","    ","    \/\/\/ íŠ¹ì • ì‚¬ìš©ìì—ê²Œ ì˜¤í¼ë¥¼ í‘œì‹œí• ì§€ ê²°ì •","    \/\/\/ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë”°ë¼ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ","    func shouldShowOffer(","        offerId: String,","        subscriptionStatus: Product.SubscriptionInfo.Status?","    ) -> Bool {","        guard let status = subscriptionStatus else {","            \/\/ êµ¬ë… ìƒíƒœ ì—†ìŒ â†’ ì´íƒˆ ì‚¬ìš©ì, ìœˆë°± ì˜¤í¼ í‘œì‹œ","            return true","        }","        ","        switch status.state {","        case .subscribed:","            \/\/ í˜„ì¬ êµ¬ë… ì¤‘ â†’ ì—…ê·¸ë ˆì´ë“œ ì˜¤í¼ë§Œ í‘œì‹œ","            return false","        case .expired:","            \/\/ ë§Œë£Œë¨ â†’ ìœˆë°± ì˜¤í¼ í‘œì‹œ","            return true","        case .inBillingRetryPeriod:","            \/\/ ê²°ì œ ì¬ì‹œë„ ì¤‘ â†’ ë¦¬í…ì…˜ ì˜¤í¼ í‘œì‹œ","            return true","        case .inGracePeriod:","            \/\/ ìœ ì˜ˆ ê¸°ê°„ â†’ ë¦¬í…ì…˜ ì˜¤í¼ í‘œì‹œ","            return true","        case .revoked:","            \/\/ ì·¨ì†Œ\/í™˜ë¶ˆë¨ â†’ ìœˆë°± ì˜¤í¼ í‘œì‹œ","            return true","        default:","            return false","        }","    }","}","","struct PromoOfferInfo: Identifiable {","    let id: String","    let type: Product.SubscriptionOffer.OfferType","    let displayPrice: String","    let period: Product.SubscriptionPeriod","    let periodCount: Int","    let paymentMode: Product.SubscriptionOffer.PaymentMode","    ","    var description: String {","        switch paymentMode {","        case .freeTrial:","            return \"\\(period.value)ì¼ ë¬´ë£Œ\"","        case .payAsYouGo:","            return \"\\(periodCount)íšŒ \\(displayPrice)\"","        case .payUpFront:","            return \"\\(displayPrice) ì„ ë¶ˆ\"","        @unknown default:","            return displayPrice","        }","    }","}"],"syntax":"swift","highlights":[],"type":"file"},"10-offer-code-view.swift":{"fileName":"OfferCodeView.swift","fileType":"swift","identifier":"10-offer-code-view.swift","content":["import SwiftUI","import StoreKit","","\/\/\/ ì˜¤í¼ ì½”ë“œ ì…ë ¥ UI","struct OfferCodeView: View {","    @State private var showingRedeemSheet = false","    @State private var redeemStatus: RedeemStatus = .idle","    @Environment(\\.dismiss) private var dismiss","    ","    var body: some View {","        VStack(spacing: 24) {","            \/\/ í—¤ë”","            VStack(spacing: 12) {","                Image(systemName: \"ticket\")","                    .font(.system(size: 60))","                    .foregroundStyle(.accent)","                ","                Text(\"ì˜¤í¼ ì½”ë“œ ì‚¬ìš©\")","                    .font(.title.bold())","                ","                Text(\"í”„ë¡œëª¨ì…˜ ì½”ë“œê°€ ìˆìœ¼ì‹ ê°€ìš”?\\nì½”ë“œë¥¼ ì…ë ¥í•˜ì—¬ íŠ¹ë³„ í˜œíƒì„ ë°›ìœ¼ì„¸ìš”.\")","                    .font(.subheadline)","                    .foregroundStyle(.secondary)","                    .multilineTextAlignment(.center)","            }","            .padding(.top, 40)","            ","            Spacer()","            ","            \/\/ ì½”ë“œ ì…ë ¥ ë²„íŠ¼","            Button {","                showingRedeemSheet = true","            } label: {","                Label(\"ì½”ë“œ ì…ë ¥í•˜ê¸°\", systemImage: \"barcode\")","                    .font(.headline)","                    .frame(maxWidth: .infinity)","                    .padding()","                    .background(Color.accentColor)","                    .foregroundStyle(.white)","                    .clipShape(RoundedRectangle(cornerRadius: 12))","            }","            ","            \/\/ ì½”ë“œ ìˆ˜ë ¹ ë°©ë²• ì•ˆë‚´","            VStack(alignment: .leading, spacing: 12) {","                Text(\"ì½”ë“œë¥¼ ë°›ëŠ” ë°©ë²•\")","                    .font(.headline)","                ","                CodeSourceRow(","                    icon: \"envelope\",","                    title: \"ì´ë©”ì¼\",","                    description: \"ë‰´ìŠ¤ë ˆí„° êµ¬ë…ì ì „ìš© ì½”ë“œ\"","                )","                ","                CodeSourceRow(","                    icon: \"person.2\",","                    title: \"ì¹œêµ¬ ì¶”ì²œ\",","                    description: \"ì¹œêµ¬ì—ê²Œ ë°›ì€ ì¶”ì²œ ì½”ë“œ\"","                )","                ","                CodeSourceRow(","                    icon: \"megaphone\",","                    title: \"í”„ë¡œëª¨ì…˜\",","                    description: \"ì´ë²¤íŠ¸ ì°¸ì—¬ ë³´ìƒ ì½”ë“œ\"","                )","            }","            .padding()","            .background(Color(.systemGray6))","            .clipShape(RoundedRectangle(cornerRadius: 16))","            ","            \/\/ ìƒíƒœ ë©”ì‹œì§€","            statusView","        }","        .padding()","        .offerCodeRedemption(isPresented: $showingRedeemSheet) { result in","            handleRedemptionResult(result)","        }","    }","    ","    @ViewBuilder","    private var statusView: some View {","        switch redeemStatus {","        case .idle:","            EmptyView()","        case .success:","            Label(\"ì½”ë“œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\", systemImage: \"checkmark.circle.fill\")","                .foregroundStyle(.green)","                .padding()","        case .error(let message):","            Label(message, systemImage: \"xmark.circle.fill\")","                .foregroundStyle(.red)","                .padding()","        }","    }","    ","    private func handleRedemptionResult(_ result: Result<Void, Error>) {","        switch result {","        case .success:","            redeemStatus = .success","            \/\/ ì„±ê³µ í›„ ìë™ìœ¼ë¡œ ë‹«ê¸°","            DispatchQueue.main.asyncAfter(deadline: .now() + 2) {","                dismiss()","            }","        case .failure(let error):","            if let storeError = error as? StoreKit.StoreKitError {","                switch storeError {","                case .userCancelled:","                    redeemStatus = .idle","                default:","                    redeemStatus = .error(\"ì½”ë“œë¥¼ ì ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\")","                }","            } else {","                redeemStatus = .error(error.localizedDescription)","            }","        }","    }","}","","enum RedeemStatus {","    case idle","    case success","    case error(String)","}","","struct CodeSourceRow: View {","    let icon: String","    let title: String","    let description: String","    ","    var body: some View {","        HStack(spacing: 12) {","            Image(systemName: icon)","                .font(.title2)","                .foregroundStyle(.accent)","                .frame(width: 32)","            ","            VStack(alignment: .leading, spacing: 2) {","                Text(title)","                    .font(.subheadline.bold())","                Text(description)","                    .font(.caption)","                    .foregroundStyle(.secondary)","            }","        }","    }","}","","#Preview {","    OfferCodeView()","}"],"syntax":"swift","highlights":[],"type":"file"},"doc://storekit.HIGStoreKit/tutorials/HIGStoreKit/07-Subscriptions#Check-Your-Understanding":{"titleInlineContent":[{"type":"text","text":"Check Your Understanding"}],"identifier":"doc:\/\/storekit.HIGStoreKit\/tutorials\/HIGStoreKit\/07-Subscriptions#Check-Your-Understanding","type":"link","title":"Check Your Understanding","url":"\/tutorials\/higstorekit\/07-subscriptions#Check-Your-Understanding"}}}